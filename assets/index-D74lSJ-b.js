(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function e(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=e(s);fetch(s.href,a)}})();const $="modulepreload",J=function(n){return"/SavingSeries/"+n},H={},k=function(t,e,i){let s=Promise.resolve();if(e&&e.length>0){let d=function(o){return Promise.all(o.map(l=>Promise.resolve(l).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),c=r?.nonce||r?.getAttribute("nonce");s=d(e.map(o=>{if(o=J(o),o in H)return;H[o]=!0;const l=o.endsWith(".css"),p=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${p}`))return;const u=document.createElement("link");if(u.rel=l?"stylesheet":$,l||(u.as="script"),u.crossOrigin="",u.href=o,c&&u.setAttribute("nonce",c),document.head.appendChild(u),l)return new Promise((E,h)=>{u.addEventListener("load",E),u.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${o}`)))})}))}function a(r){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=r,window.dispatchEvent(c),!c.defaultPrevented)throw r}return s.then(r=>{for(const c of r||[])c.status==="rejected"&&a(c.reason);return t().catch(a)})},V=(n,t,e)=>{const i=n[t];return i?typeof i=="function"?i():Promise.resolve(i):new Promise((s,a)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(a.bind(null,new Error("Unknown variable dynamic import: "+t+(t.split("/").length!==e?". Note that variables only represent file names one level deep.":""))))})};(function(){const n="data-i18n-key",t="data-i18n-title",e="data-i18n-placeholder",s={};let a="en";async function r(h){try{const m=await V(Object.assign({"../locales/en.json":()=>k(()=>import("./en-DbTHIFS9.js"),[]),"../locales/ru.json":()=>k(()=>import("./ru-Ci7Jy37d.js"),[])}),`../locales/${h}.json`,3);return s[h]=m.default,!0}catch(m){const v=h.split("-")[0];if(v!==h)try{const I=await V(Object.assign({"../locales/en.json":()=>k(()=>import("./en-DbTHIFS9.js"),[]),"../locales/ru.json":()=>k(()=>import("./ru-Ci7Jy37d.js"),[])}),`../locales/${v}.json`,3);return s[h]=I.default,s[v]=I.default,!0}catch{}return console.error(`Translation file for "${h}" not found, falling back to "en".`,m),h!=="en"&&await r("en"),!1}}function c(h=document){if(!s[a])return;const m=a,v=(w,B,Y)=>{if(w.hasAttribute(B)){const j=w.getAttribute(B);s[m]&&s[m][j]&&(w[Y]=s[m][j])}};h.querySelectorAll(`[${n}], [${t}], [${e}]`).forEach(w=>{v(w,n,"textContent"),v(w,t,"title"),v(w,e,"placeholder")})}function d(){const h=document.querySelector(`title[${n}]`);if(h){const m=h.getAttribute(n);s[a]&&s[a][m]&&(document.title=s[a][m])}}async function o(h){h===a&&s[h]||(s[h]||await r(h),a=h,document.documentElement.lang=h,c(document.body),d(),localStorage.setItem("preferredLanguage",h),document.dispatchEvent(new CustomEvent("languagechange")))}function l(h,m={}){let v=s[a]?.[h]||h;for(const I in m)v=v.replace(`{${I}}`,m[I]);return v}function p(){return a}function u(){return Object.keys(Object.assign({"../locales/en.json":()=>k(()=>import("./en-DbTHIFS9.js"),[]),"../locales/ru.json":()=>k(()=>import("./ru-Ci7Jy37d.js"),[])})).map(m=>m.match(/([a-zA-Z-]+)\.json$/)[1])}async function E(){const h=localStorage.getItem("preferredLanguage"),m=navigator.language;await o(h||m||"en")}window.i18n={setLanguage:o,applyTo:c,t:l,init:E,getCurrentLanguage:p,getAvailableLanguages:u},document.addEventListener("DOMContentLoaded",window.i18n.init)})();const b={RUN:"0",PAUSE:"1",COMPLETED:"2",JUST_WATCH:"3"};function z(){return[{value:b.RUN,text:window.i18n.t("status_run")},{value:b.PAUSE,text:window.i18n.t("status_pause")},{value:b.COMPLETED,text:window.i18n.t("status_completed")},{value:b.JUST_WATCH,text:window.i18n.t("status_just_watch")}]}const S={RELEASED:1,RELEASED_LONG_AGO:2,RELEASED_NEXT_7_DAYS:3,WITH_DATE_OTHERS:4,WITHOUT_DATE:5,ON_PAUSE:6,COMPLETED:7};function K(){const n=new Map;return n.set(S.RELEASED,window.i18n.t("list_name_released")),n.set(S.RELEASED_LONG_AGO,window.i18n.t("list_name_released_long_ago")),n.set(S.RELEASED_NEXT_7_DAYS,window.i18n.t("list_name_released_next_7_days")),n.set(S.WITH_DATE_OTHERS,window.i18n.t("list_name_with_date_others")),n.set(S.WITHOUT_DATE,window.i18n.t("list_name_without_date")),n.set(S.ON_PAUSE,window.i18n.t("list_name_on_pause")),n.set(S.COMPLETED,window.i18n.t("list_name_completed")),n}function N(n){return document.querySelector(n)}function O(n,t){n&&n.classList.add(t)}function y(n,t){n&&n.classList.remove(t)}function g(n){O(n,"hide")}function L(n){y(n,"hide")}function X({duration:n,draw:t,timing:e=s=>s,complete:i=null}){let s=performance.now();requestAnimationFrame(function a(r){let c=(r-s)/n;c>1&&(c=1),t(e(c)),c<1?requestAnimationFrame(a):i&&i()})}function W(n){return n&&n.data.date?n.data.date.toDate?n.data.date.toDate().toLocaleDateString(window.i18n.getCurrentLanguage(),{year:"numeric",month:"long",day:"numeric"}):n.data.date.toLocaleDateString(window.i18n.getCurrentLanguage(),{year:"numeric",month:"long",day:"numeric"}):""}function Z(n){return n&&n.data.date?n.data.date.toDate?n.data.date.toDate().toISOString().split("T")[0]:n.data.date.toISOString().split("T")[0]:""}function Q(n){return n===""?"":new Date(n)}function tt(n){if(n.length>0){let t=document.createElement("a");return t.target="_blank",t.href=n,t.host.length>0&&(t.innerText=t.host),t}else return""}function et(){let n=new Date;return n.setHours(23,59,59,999),n}function M(n){let t;if(n.data.status===b.COMPLETED)t=S.COMPLETED;else if(n.data.status===b.PAUSE)t=S.ON_PAUSE;else if(n.data.status===b.JUST_WATCH)t=S.RELEASED_LONG_AGO;else if(n.data.date==="")t=S.WITHOUT_DATE;else{let e=et();n.data.date<e?t=S.RELEASED:(e.setDate(e.getDate()+7),n.data.date<e?t=S.RELEASED_NEXT_7_DAYS:t=S.WITH_DATE_OTHERS)}return t}function it(n,t){let e;return function(...i){const s=this;clearTimeout(e),e=setTimeout(()=>n.apply(s,i),t)}}class P{constructor(t,e={}){this.templateId=t,this.options=e,this.generate()}open(){this.dialog&&typeof this.dialog.showModal=="function"&&(this.dialog.parentElement||N("body").append(this.dialog),this.setListeners(),this.dialog.showModal())}close(){this.dialog&&typeof this.dialog.close=="function"&&this.dialog.close()}generate(){const t=document.getElementById(this.templateId);if(!t){console.error(`Template with id "${this.templateId}" not found.`);return}const e=t.content.cloneNode(!0);if(this.dialog=e.querySelector("dialog")||e.firstElementChild,!this.dialog){console.error(`No dialog element found in template with id "${this.templateId}".`);return}this.dialog.addEventListener("close",()=>{})}setListeners(){if(this.listenersSet)return;this.dialog.addEventListener("click",e=>{e.target===this.dialog&&this.options.closeOnBackdropClick&&this.close()});const t=this.dialog.querySelector(".close");t&&(t.onclick=()=>this.close()),this.listenersSet=!0}get element(){return this.dialog}}class T{static DATABASE_NAME="SavingSeries";static OBJECT_STORE_NAME="series";static#t;constructor(){}static getInstance(){return T.#t||(T.#t=new T),T.#t}connect(t){let e=indexedDB.open(T.DATABASE_NAME,1);e.onsuccess=()=>{this.database=e.result,t()},e.onupgradeneeded=async()=>{const i=()=>indexedDB.deleteDatabase(T.DATABASE_NAME);window.addEventListener("pagehide",i),e.result.createObjectStore(T.OBJECT_STORE_NAME,{keyPath:"id"}),await new P("Данные будут храниться на вашем компьютере").open()?(window.removeEventListener("pagehide",i),this.connect(t)):(window.removeEventListener("pagehide",i),indexedDB.deleteDatabase(T.DATABASE_NAME),alert("Приложение не может работать без доступа к хранилищу"),N("body").style.display="none")}}getObjectStore(t){return this.database.transaction(T.OBJECT_STORE_NAME,t).objectStore(T.OBJECT_STORE_NAME)}getReadWriteObjectStore(){return this.getObjectStore("readwrite")}getReadOnlyObjectStore(){return this.getObjectStore("readonly")}putSeriesInDb(t){return this.getReadWriteObjectStore().put(t.data)}deleteSeriesFromDb(t){return this.getReadWriteObjectStore().delete(t.data.id)}foreach(t,e=null){let i=this.getReadOnlyObjectStore().openCursor(),s=0;i.onsuccess=function(){let a=i.result;a?(t(a.value),s=a.value.id,a.continue()):e&&e(s)}}clear(){this.getReadWriteObjectStore().clear()}}class _{static onItemClickListener=()=>!1;static validate(t){if(t)try{if(t.name!==""){let e=parseInt(t.season),i=parseInt(t.episode);if(e>=1&&e<=50&&i>=1&&i<=5e4)return{id:0,name:t.name,season:e,episode:i,date:t.date?t.date.toDate?t.date.toDate():new Date(t.date):"",site:t.site?t.site:"",image:t.image?t.image:"",note:t.note?t.note:"",status:t.status?t.status:b.RUN}}}catch{}return null}static create(t){const e=_.validate(t);return e?new _(t.id,e.name,e.season,e.episode,e.date,e.site,e.image,e.status,e.note):null}constructor(t,e,i,s,a,r,c,d,o){this.data={id:t,name:e,season:i,episode:s,date:a,site:r,image:c,status:d,note:o},this.onUpdateListener=null,this.onDeleteListener=null,this.generate()}getFragment(){return this.item}generate(){const t=document.getElementById("seriesTemplate");this.fragment=t.content.cloneNode(!0),this.item=this.fragment.querySelector(".item-outer"),this.item.id=`item${this.data.id}`,this.image=this.fragment.querySelector(".image"),this.image.style.backgroundImage=`url("${this.data.image}")`,this.link=this.fragment.querySelector(".link"),this.data.site&&(this.link.href=this.data.site,L(this.link)),this.info=this.fragment.querySelector(".info"),this.infoSeasonValue=this.info.querySelector(".season > .value"),this.infoEpisodeValue=this.info.querySelector(".episode > .value"),this.infoDate=this.info.querySelector(".date"),this.infoDateValue=this.info.querySelector(".date > .value");const e=this.fragment.querySelector(".name");e.title=this.data.name,e.textContent=this.data.name,this.item.onclick=()=>_.onItemClickListener(this.data.id),this.link.onclick=i=>i.stopPropagation(),this.updateInfo(),window.i18n.applyTo(this.item)}retranslate(){window.i18n.applyTo(this.item),this.updateInfo()}updateInfo(){if(this.data.status===b.COMPLETED){g(this.info);return}else L(this.info);if(this.infoSeasonValue.innerText=this.data.season,this.infoEpisodeValue.innerText=this.data.episode,this.data.status===b.JUST_WATCH)g(this.infoDate);else{let t=W(this);t===""?g(this.infoDate):(this.infoDateValue.innerText=t,L(this.infoDate))}}static compressImage(t){let e=document.createElement("img");e.src=t;let i=document.createElement("canvas");return i.width=e.width,i.height=e.height,i.getContext("2d").drawImage(e,0,0),i.toDataURL("image/jpeg",.5)}updateImage(){this.data.image.length>0&&(this.data.image=_.compressImage(this.data.image)),this.image.style.backgroundImage=`url("${this.data.image}")`}updateLink(){this.data.site===""?g(this.link):(this.link.href=this.data.site,L(this.link))}delete(){this.onDeleteListener!==null&&this.onDeleteListener()}remove(){this.item.remove()}compareDates(t,e){return t===""&&e===""?!0:t===""||e===""?!1:t.getTime()===e.getTime()}update(t,e,i,s,a,r,c){let d=!1,o=!1;return this.data.season!==t&&(this.data.season=t,o=!0),this.data.episode!==e&&(this.data.episode=e,o=!0),this.compareDates(this.data.date,i)||(this.data.date=i,d=!0,o=!0),this.data.site!==s&&(this.data.site=s,this.updateLink()),this.data.image!==a&&(this.data.image=a,this.updateImage()),this.data.status!==r&&(this.data.status=r,d=!0),this.data.note!==c&&(this.data.note=c),o&&this.updateInfo(),d&&this.onUpdateListener!==null&&this.onUpdateListener(),d}}function q(n,t){n.oninput=()=>C(n,t)}function C(n,t){let e=n.validity;if(e.valid){y(n,"error"),t.innerText="";return}e.valueMissing?t.innerText="Это поле необходимо заполнить.":e.typeMismatch?n.type==="number"?t.innerText="Пожалуйста, введите число.":n.type==="date"?t.innerText="Пожалуйста, введите корректную дату.":n.type==="url"?t.innerText="Пожалуйста, введите корректный URL.":t.innerText="Пожалуйста, введите правильное значение.":e.rangeUnderflow?t.innerText="Пожалуйста, введите число, большее или равное {0}.".replace("{0}",n.min):e.rangeOverflow?t.innerText="Пожалуйста, введите число, меньшее или равное {0}.".replace("{0}",n.max):e.tooLong?t.innerText="Пожалуйста, введите не более {0} символов.".replace("{0}",n.maxLength):t.innerText="Пожалуйста, введите правильное значение.",O(n,"error")}class R{static ENTER_KEY="Enter";static ESCAPE_KEY="Escape";constructor(t,e=!0){this.id=t,this.needTop=e,this.generate()}getFragment(){return this.fullitem}generate(){const t=document.getElementById("fullitemTemplate");if(this.fragment=t.content.cloneNode(!0),this.fullitem=this.fragment.querySelector(".fullitem"),this.fullitem.id=`fullitem${this.id}`,this.needTop){const s=this.fragment.querySelector(".name-title");s&&(s.id=`nameTitle${this.id}`)}else{const s=this.fragment.querySelector(".top");s&&s.remove()}this.form=this.fragment.querySelector("form"),this.form.id=`form${this.id}`;const e=this.getInputsHtml();e&&this.form.insertAdjacentHTML("afterbegin",e);const i=this.fragment.querySelector(".button-container");i.innerHTML=this.getButtonContainerInnerHtml(),this.getFields(),this.populateStatusOptions(),this.getButtons(),this.setListeners()}populateStatusOptions(){z().forEach(e=>{const i=document.createElement("option");i.value=e.value,i.textContent=e.text,this.fields.status.input.appendChild(i)})}getInputsHtml(){return""}getButtonContainerInnerHtml(){return""}getFields(){this.fields={season:{div:this.fragment.querySelector("input[name='season']").closest(".row"),value:this.fragment.querySelector("input[name='season']").closest(".row").querySelector(".value"),input:this.fragment.querySelector("input[name='season']"),error:this.fragment.querySelector("input[name='season']").closest(".row").querySelector(".error")},episode:{div:this.fragment.querySelector("input[name='episode']").closest(".row"),value:this.fragment.querySelector("input[name='episode']").closest(".row").querySelector(".value"),input:this.fragment.querySelector("input[name='episode']"),error:this.fragment.querySelector("input[name='episode']").closest(".row").querySelector(".error")},date:{div:this.fragment.querySelector("input[name='date']").closest(".row"),value:this.fragment.querySelector("input[name='date']").closest(".row").querySelector(".value"),input:this.fragment.querySelector("input[name='date']"),error:this.fragment.querySelector("input[name='date']").closest(".row").querySelector(".error")},site:{div:this.fragment.querySelector("input[name='site']").closest(".row"),value:this.fragment.querySelector("input[name='site']").closest(".row").querySelector(".value"),input:this.fragment.querySelector("input[name='site']"),error:this.fragment.querySelector("input[name='site']").closest(".row").querySelector(".error")},image:{div:this.fragment.querySelector("input[name='image']").closest(".row"),value:this.fragment.querySelector(".image"),input:this.fragment.querySelector("input[name='image']"),error:this.fragment.querySelector("input[name='image']").closest(".row").querySelector(".error")},status:{div:this.fragment.querySelector("select[name='status']").closest(".row"),input:this.fragment.querySelector("select[name='status']")},note:{div:this.fragment.querySelector("textarea[name='note']").closest(".row"),value:this.fragment.querySelector("textarea[name='note']").closest(".row").querySelector(".value"),input:this.fragment.querySelector("textarea[name='note']")}}}getButtons(){this.buttons={close:{div:this.fragment.querySelector(".outer-close"),button:this.fragment.querySelector(".close")}}}setListeners(){this.form.onsubmit=t=>t.preventDefault(),this.buttons.close.button.onclick=()=>this.close(),this.fields.image.input.onchange=()=>this.changeImage(),this.fields.status.input.onchange=()=>this.onChangeStatus(),this.setValidators()}setValidators(){q(this.fields.season.input,this.fields.season.error),q(this.fields.episode.input,this.fields.episode.error),q(this.fields.date.input,this.fields.date.error),q(this.fields.site.input,this.fields.site.error)}validateInputs(){C(this.fields.season.input,this.fields.season.error),C(this.fields.episode.input,this.fields.episode.error),C(this.fields.date.input,this.fields.date.error),C(this.fields.site.input,this.fields.site.error)}open(){let t=N(`.fullitem:not(.hide):not(#fullitem${this.id})`);g(t),this.resetInputValues(),this.setKeyboardListener(),L(this.fullitem),setTimeout(()=>this.fullitem.scrollIntoView({behavior:"smooth",block:"end"}),35)}setKeyboardListener(){document.onkeyup=t=>this.keyboardListen(t.key)}removeKeyboardListener(){document.onkeyup=null}keyboardListen(t){}clearActiveItem(){y(N(".item-outer.active"),"active")}hide(){g(this.fullitem)}close(){this.removeKeyboardListener(),this.hide()}remove(){this.fullitem.remove()}changeImage(){this.setErrorToImageInput();let t=new FileReader;t.onload=()=>this.fields.image.value.style.backgroundImage=`url(${t.result})`;let e=this.fields.image.input.files[0];e&&(e.type.startsWith("image/")?e.size>10*1024*1024?this.setErrorToImageInput(window.i18n.t("file_too_large")):t.readAsDataURL(e):this.setErrorToImageInput(window.i18n.t("not_an_image")))}setErrorToImageInput(t){t?(this.fields.image.error.innerText=t,O(this.fields.image.input,"error")):y(this.fields.image.input,"error")}getStatusState(){let t=this.fields.status.input.value,e={season:!0,episode:!0,date:!0};switch(t){case b.COMPLETED:e.season=!1,e.episode=!1,e.date=!1;break;case b.JUST_WATCH:e.date=!1;break}return e}onChangeStatus(){let t=this.getStatusState();t.season?L(this.fields.season.div):g(this.fields.season.div),t.episode?L(this.fields.episode.div):g(this.fields.episode.div),t.date?L(this.fields.date.div):g(this.fields.date.div)}showEditFields(t){let e=this.fullitem.querySelectorAll(".on-edit"),i=this.fullitem.querySelectorAll(".not-on-edit");t?(e.forEach(s=>L(s)),i.forEach(s=>g(s))):(e.forEach(s=>g(s)),i.forEach(s=>L(s)))}setDisplayValues(t){this.fields.name.value.innerText=t.data.name,this.fields.season.value.innerText=t.data.season,this.fields.episode.value.innerText=t.data.episode,this.fields.date.value.innerText=W(t),this.fields.site.value.innerHTML=tt(t.data.site).outerHTML,this.fields.image.value.style.backgroundImage=`url("${t.data.image}")`,this.fields.note.value.innerText=t.data.note}setInputValues(t){this.fields.season.input.value=t.data.season,this.fields.episode.input.value=t.data.episode,this.fields.date.input.value=Z(t),this.fields.site.input.value=t.data.site,this.fields.image.input.value="",this.fields.status.input.value=t.data.status,this.fields.note.input.value=t.data.note}resetInputValues(){this.form.reset(),this.fields.image.value.style.backgroundImage="",y(this.fields.season.input,"error"),y(this.fields.episode.input,"error"),y(this.fields.date.input,"error"),y(this.fields.site.input,"error")}checkInputs(){let t=this.getStatusState();return t.season&&!this.fields.season.input.validity.valid||t.episode&&!this.fields.episode.input.validity.valid||t.date&&!this.fields.date.input.validity.valid?!1:this.fields.site.input.validity.valid&&this.fields.image.input.validity.valid&&this.fields.image.input.validity.valid&&this.fields.status.input.validity.valid&&this.fields.note.input.validity.valid}getValuesFromInputs(){return this.checkInputs()?{season:this.fields.season.input.value,episode:this.fields.episode.input.value,date:Q(this.fields.date.input.value),site:this.fields.site.input.value,backgroundImage:this.fields.image.value.style.backgroundImage,status:this.fields.status.input.value,note:this.fields.note.input.value}:null}}class st extends R{constructor(t,e){super(t.id),this.container=t,this.database=e,this.default=!0}getButtonContainerInnerHtml(){return document.getElementById("fullitemButtonsTemplate").innerHTML}getFields(){super.getFields(),this.fields.name={value:this.fragment.querySelector(".name-title")}}getButtons(){super.getButtons(),this.buttons.change={div:this.fragment.querySelector(".change-button"),button:this.fragment.querySelector(".change-button button")},this.buttons.update={div:this.fragment.querySelector(".update-button"),button:this.fragment.querySelector(".update-button button")},this.buttons.cancel={div:this.fragment.querySelector(".cancel-button"),button:this.fragment.querySelector(".cancel-button button")},this.buttons.accept={div:this.fragment.querySelector(".accept-button"),button:this.fragment.querySelector(".accept-button button")},this.buttons.delete={div:this.fragment.querySelector(".delete-button"),button:this.fragment.querySelector(".delete-button button")}}setListeners(){super.setListeners(),this.buttons.change.button.onclick=()=>this.change(),this.buttons.update.button.onclick=()=>this.update(),this.buttons.cancel.button.onclick=()=>this.cancel(),this.buttons.accept.button.onclick=()=>this.accept(),this.buttons.delete.button.onclick=()=>this.delete()}keyboardListen(t){t===R.ENTER_KEY?this.changeMode&&this.accept():t===R.ESCAPE_KEY&&(this.changeMode?this.cancel():this.close())}showAllFields(){this.form.querySelectorAll(".row").forEach(t=>L(t))}hideEmptyFields(){this.series.data.date===""&&g(this.fields.date.div),this.series.data.site===""&&g(this.fields.site.div),this.series.data.note===""&&g(this.fields.note.div),this.series.data.date===""&&this.series.data.status!==b.JUST_WATCH&&g(this.buttons.update.div)}applyUpdateButton(){this.series.data.date===""?this.buttons.update.button.title=window.i18n.t("next_episode"):this.buttons.update.button.title=window.i18n.t("next_episode_in_a_week")}turnOnActiveItem(){this.clearActiveItem(),O(this.series.getFragment(),"active")}needToOpen(t){return!(!this.fullitem.classList.contains("hide")&&this.series&&this.series.data.id===t.data.id)}open(t){this.needToOpen(t)?(this.series=t,this.changeMode=!1,this.moveByGridState(),super.open(),this.setSeries(t),this.turnOnActiveItem(),this.showAllFields(),this.showEditFields(!1),this.onChangeStatus(),this.hideEmptyFields(),this.applyUpdateButton()):this.close()}moveByGridState(){if(this.container.grid){if(this.series){this.default=!1;let t=this.container.hlcList.childNodes,e=Array.from(t),i=e.indexOf(this.fullitem);i>-1&&e.splice(i,1);let s=e.indexOf(this.series.getFragment());s=Math.floor(s/this.container.countNumber)*this.container.countNumber+(this.container.countNumber-1)+(i>-1&&i<=s+(this.container.countNumber-s%this.container.countNumber)?1:0),s>=t.length&&(s=t.length-1),t.item(s).insertAdjacentElement("afterend",this.fullitem)}}else this.moveToDefault()}moveToDefault(){this.default||(this.container.container.append(this.fullitem),this.default=!0)}close(){this.changeMode=!1,this.series=null,super.close(),this.clearActiveItem()}setSeries(t){this.setDisplayValues(t),this.setInputValues(t)}change(){this.changeMode=!0,this.showAllFields(),this.showEditFields(!0),this.onChangeStatus()}update(){let t=this.series.data.date;t!==""&&(t=new Date(this.series.data.date),t.setDate(t.getDate()+7));let e=this.series.update(this.series.data.season,parseInt(this.series.data.episode)+1,t,this.series.data.site,this.series.data.image,this.series.data.status,this.series.data.note);if(this.database.putSeriesInDb(this.series),e&&M(this.series)!==this.id){this.close();return}this.changeMode=!1,this.setDisplayValues(this.series),this.setInputValues(this.series)}cancel(){this.fields.image.value.style.backgroundImage=`url("${this.series.data.image}")`,this.setInputValues(this.series),this.showAllFields(),this.showEditFields(!1),this.onChangeStatus(),this.hideEmptyFields()}accept(){let t=this.getValuesFromInputs();if(!t)return;let e=t.backgroundImage.length>7?t.backgroundImage.slice(5,-2):this.series.data.image,i=this.series.update(t.season,t.episode,t.date,t.site,e,t.status,t.note);if(this.database.putSeriesInDb(this.series),i&&M(this.series)!==this.id){this.close();return}this.changeMode=!1,this.setDisplayValues(this.series),this.showAllFields(),this.showEditFields(!1),this.onChangeStatus(),this.hideEmptyFields(),this.applyUpdateButton()}async delete(){await new P(window.i18n.t("confirm_delete",{name:this.series.data.name})).open()&&(this.series.delete(),this.database.deleteSeriesFromDb(this.series),this.close())}}class U extends R{static seriesId=0;constructor(t,e){super("add",!1),this.showSeries=t,this.database=e}getInputsHtml(){return document.getElementById("fullitemInputsTemplate").innerHTML}getButtonContainerInnerHtml(){return document.getElementById("addingFullitemButtonsTemplate").innerHTML}setSeriesId(t){U.seriesId=t}getFields(){super.getFields(),this.fields.name={input:this.fragment.querySelector("input[name='name']"),error:this.fragment.querySelector("input[name='name']").closest(".row").querySelector(".error")}}getButtons(){super.getButtons(),this.buttons.add={div:this.fragment.querySelector(".add-button"),button:this.fragment.querySelector(".add-button button")}}setListeners(){super.setListeners(),this.buttons.add.button.onclick=()=>this.add()}setValidators(){q(this.fields.name.input,this.fields.name.error),super.setValidators()}validateInputs(){super.validateInputs(),C(this.fields.name.input,this.fields.name.error)}keyboardListen(t){t===R.ENTER_KEY?this.add():t===R.ESCAPE_KEY&&this.close()}resetInputValues(){this.fields.name.input.value="",y(this.fields.name.input,"error"),super.resetInputValues()}open(){this.fullitem.classList.contains("hide")&&(super.open(),this.resetInputValues(),this.showEditFields(!0),this.onChangeStatus(),this.clearActiveItem())}checkInputs(){return this.fields.name.input.validity.valid?super.checkInputs():!1}add(){let t=this.getValuesFromInputs();if(!t){this.validateInputs();return}let e=this.fields.name.input.value,i=t.backgroundImage.length>7?t.backgroundImage.slice(5,-2):"",s=new _(U.seriesId++,e,t.season,t.episode,t.date,t.site,i,t.status,t.note);this.database.putSeriesInDb(s),this.close(),this.showSeries(s)}}class nt{constructor(t,e,i){this.id=t,this.title=e,this.app=i,this.map=new Map,this.countNumber=this.getCountNumberFromLocalStorage(),this.grid=this.getGridStatusFromLocalStorage(),this.fullitem=new st(this,this.app.database),this.generate()}updateTitle(t){this.title=t,this.container.querySelector(".title").textContent=this.title}getFragment(){return this.container}generate(){const t=document.getElementById("containerTemplate");this.fragment=t.content.cloneNode(!0),this.container=this.fragment.querySelector(".hlist-container"),this.container.id=`horizontalContainer${this.id}`,this.container.append(this.fullitem.getFragment()),this.container.querySelector(".title").textContent=this.title,this.scrollableList=this.fragment.querySelector(".outer-list"),this.hlcList=this.fragment.querySelector(".list"),this.leftButton=this.fragment.querySelector(".left-control"),this.rightButton=this.fragment.querySelector(".right-control"),this.countButton=this.fragment.querySelector(".count-icon"),this.gridButton=this.fragment.querySelector(".grid-icon"),this.setButtonListeners(),this.updateByCount(),this.turnGridMode(this.grid)}getCountNumberFromLocalStorage(){const t=this.app.localStorage.getCountNumberOfContainer(this.id);return{two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9}[t]||4}setCountToLocalStorage(t){this.app.localStorage.setCountNumberOfContainer(this.id,t)}getGridStatusFromLocalStorage(){return this.app.localStorage.getGridStateOfContainer(this.id)==="true"}setGridStatusToLocalStorage(t){this.app.localStorage.setGridStateOfContainer(this.id,t?"true":"false")}onScrollStopped(t,e,i=300){e.timeout=0,t.onscroll=()=>{let s=Date.now();s-e.timeout>=i&&(e.timeout=s,setTimeout(e,i))}}scrollList(t){let e=this.scrollableList.scrollLeft,i=this.scrollableList.offsetWidth;X({duration:250,draw:s=>t(e,i,s)})}scrollListToLeft(){this.scrollList((t,e,i)=>this.scrollableList.scrollLeft=t-e*i)}scrollListToRight(){this.scrollList((t,e,i)=>this.scrollableList.scrollLeft=t+e*i)}setButtonListeners(){this.onScrollStopped(this.scrollableList,()=>this.checkLeftRightButtons()),this.leftButton.onclick=t=>{t.preventDefault(),this.scrollListToLeft()},this.rightButton.onclick=t=>{t.preventDefault(),this.scrollListToRight()},this.countButton.onclick=()=>{this.countNumber--,this.countNumber===1&&(this.countNumber=9),this.updateByCount()},this.gridButton.onclick=()=>{this.turnGridMode(!this.grid)}}updateByCount(){const e={2:"two",3:"three",4:"four",5:"five",6:"six",7:"seven",8:"eight",9:"nine"}[this.countNumber]||"four";let i=["two","three","four","five","six","seven","eight","nine"];this.countButton.classList.remove(...i),this.countButton.classList.add(e),this.hlcList.classList.remove(...i),this.hlcList.classList.add(e),this.checkLeftRightButtons(),this.fullitem.moveByGridState(),this.setCountToLocalStorage(e)}showGrid(){this.grid=!0,O(this.gridButton,"on"),O(this.hlcList,"grid"),this.showLeftRightButtons(!1),this.fullitem.moveByGridState(),this.setGridStatusToLocalStorage(this.grid)}hideGrid(){this.grid=!1,y(this.gridButton,"on"),y(this.hlcList,"grid"),this.checkLeftRightButtons(),this.fullitem.moveToDefault(),this.setGridStatusToLocalStorage(this.grid)}turnGridMode(t=!1){t?this.showGrid():this.hideGrid()}showLeftRightButtons(t=!0){t?(L(this.leftButton),L(this.rightButton)):(g(this.leftButton),g(this.rightButton))}checkLeftRightButtons(){if(this.grid)return;let t=this.scrollableList.scrollLeft,e=this.scrollableList.scrollWidth-this.scrollableList.clientWidth;t===0?(this.leftButton.classList.add("hide"),e===0?this.rightButton.classList.add("hide"):this.rightButton.classList.remove("hide")):(this.leftButton.classList.remove("hide"),e===t?this.rightButton.classList.add("hide"):this.rightButton.classList.remove("hide"))}show(){L(this.container),this.checkLeftRightButtons()}hide(){g(this.container)}remove(){this.container.remove()}clear(){this.hide();for(let t of this.map.values())t.remove();this.map.clear(),this.fullitem.hide()}simplyAddSeries(t){this.map.set(t.data.id,t),this.setListenersOnSeries(t)}addSeries(t){this.map.size===0&&this.show(),this.simplyAddSeries(t),this.isNeedSortByListType()&&this.sortByDate(),this.showItems(),this.checkLeftRightButtons(),this.scrollFromAnother(t)}sortByDate(){let t=[...this.map.keys()];this.map=new Map([...this.map.entries()].sort((i,s)=>i[1].data.date-s[1].data.date));let e=[...this.map.keys()];for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!0;return!1}isNeedSortByListType(){return this.id===S.RELEASED||this.id===S.RELEASED_NEXT_7_DAYS||this.id===S.WITH_DATE_OTHERS}showItems(){const t=new DocumentFragment;for(const e of this.map.values())t.append(e.getFragment());this.hlcList.append(t)}initialAdditionFinish(){this.isNeedSortByListType()&&this.sortByDate(),this.showItems(),this.map.size>0&&this.show()}setListenersOnSeries(t){t.onUpdateListener=()=>this.onSeriesUpdate(t.data.id),t.onDeleteListener=()=>this.deleteSeries(t)}removeListenersFromSeries(t){t.onUpdateListener=null,t.onDeleteListener=null}onSeriesUpdate(t){let e=this.map.get(t),i=M(e);i!==this.id?(this.deleteSeries(e,!0),this.app.relocateSeries(e,i),setTimeout(()=>this.scrollFromAnother(e),300)):this.isNeedSortByListType()&&this.sortByDate()&&(this.showItems(),this.scrollInThis(e),this.checkLeftRightButtons())}scrollFromAnother(t){t.getFragment().scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}scrollInThis(t){let e=document.documentElement.scrollTop;t.getFragment().scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),document.documentElement.scrollTop=e}deleteSeries(t,e=!1){this.removeListenersFromSeries(t),this.map.delete(t.data.id),e||t.remove(),this.map.size===0?this.hide():this.checkLeftRightButtons()}showFullItemIfExists(t){let e=this.map.get(t);return e?(this.fullitem.open(e),this.scrollInThis(e),!0):!1}}var F=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},x={exports:{}},at=x.exports,G;function ot(){return G||(G=1,(function(n,t){(function(e,i){i()})(at,function(){function e(o,l){return typeof l>"u"?l={autoBom:!1}:typeof l!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),l={autoBom:!l}),l.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(o.type)?new Blob(["\uFEFF",o],{type:o.type}):o}function i(o,l,p){var u=new XMLHttpRequest;u.open("GET",o),u.responseType="blob",u.onload=function(){d(u.response,l,p)},u.onerror=function(){console.error("could not download file")},u.send()}function s(o){var l=new XMLHttpRequest;l.open("HEAD",o,!1);try{l.send()}catch{}return 200<=l.status&&299>=l.status}function a(o){try{o.dispatchEvent(new MouseEvent("click"))}catch{var l=document.createEvent("MouseEvents");l.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),o.dispatchEvent(l)}}var r=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof F=="object"&&F.global===F?F:void 0,c=r.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),d=r.saveAs||(typeof window!="object"||window!==r?function(){}:"download"in HTMLAnchorElement.prototype&&!c?function(o,l,p){var u=r.URL||r.webkitURL,E=document.createElement("a");l=l||o.name||"download",E.download=l,E.rel="noopener",typeof o=="string"?(E.href=o,E.origin===location.origin?a(E):s(E.href)?i(o,l,p):a(E,E.target="_blank")):(E.href=u.createObjectURL(o),setTimeout(function(){u.revokeObjectURL(E.href)},4e4),setTimeout(function(){a(E)},0))}:"msSaveOrOpenBlob"in navigator?function(o,l,p){if(l=l||o.name||"download",typeof o!="string")navigator.msSaveOrOpenBlob(e(o,p),l);else if(s(o))i(o,l,p);else{var u=document.createElement("a");u.href=o,u.target="_blank",setTimeout(function(){a(u)})}}:function(o,l,p,u){if(u=u||open("","_blank"),u&&(u.document.title=u.document.body.innerText="downloading..."),typeof o=="string")return i(o,l,p);var E=o.type==="application/octet-stream",h=/constructor/i.test(r.HTMLElement)||r.safari,m=/CriOS\/[\d]+/.test(navigator.userAgent);if((m||E&&h||c)&&typeof FileReader<"u"){var v=new FileReader;v.onloadend=function(){var B=v.result;B=m?B:B.replace(/^data:[^;]*;/,"data:attachment/file;"),u?u.location.href=B:location=B,u=null},v.readAsDataURL(o)}else{var I=r.URL||r.webkitURL,w=I.createObjectURL(o);u?u.location=w:location.href=w,u=null,setTimeout(function(){I.revokeObjectURL(w)},4e4)}});r.saveAs=d.saveAs=d,n.exports=d})})(x)),x.exports}var rt=ot();class lt{constructor(t,e,i){this.database=t,this.clear=e,this.initialize=i}getCreateBackupFunction(){return()=>setTimeout(()=>this.createBackup(),0)}getLoadBackupFunction(){return()=>setTimeout(()=>this.loadBackup(),0)}createBackup(){let t=this.database.getReadOnlyObjectStore().getAll();t.onsuccess=()=>{const e=new Blob([JSON.stringify(t.result)],{type:"text/plain;charset=utf-8"});rt.saveAs(e,"SavingSeries.backup")}}async loadBackup(){if(await new P("Все имеющиеся данные будут очищены и заменены на новые").open()){let i=document.createElement("input");i.type="file",i.onchange=s=>this.onOpenFile(s),i.click()}}onOpenFile(t){let e=new FileReader;e.onload=()=>{try{let i=JSON.parse(""+e.result);if(Array.isArray(i)){this.clear();let s=0,a=this.database.getReadWriteObjectStore();for(let r of i){let c=_.validate(r);c&&(c.id=s++,a.add(c))}this.initialize();return}}catch{}alert("Содержимое файла повреждено!")},e.readAsText(t.target.files[0])}}class f{static ACTIVE_CLASS="active";static ARROW_DOWN_KEY="ArrowDown";static ARROW_UP_KEY="ArrowUp";static ENTER_KEY="Enter";static ESCAPE_KEY="Escape";static RESULT_COUNT=10;constructor(t){this.app=t,this.generate()}getFragment(){return this.container}generate(){const t=document.getElementById("searchContainerTemplate");this.fragment=t.content.cloneNode(!0),this.container=this.fragment.querySelector(".search-container"),this.search=this.fragment.querySelector(".search"),this.searchList=this.fragment.querySelector(".search-list"),this.closeButton=this.fragment.querySelector(".close"),this.setListeners(),this.clear()}setListeners(){this.search.oninput=it(()=>this.searchSeries(),200),this.search.onkeydown=t=>this.cancelDefaultAction(t),this.search.onkeyup=t=>this.moveByKeyboard(t.key),this.searchList.onmousedown=t=>this.onMouseDown(t),this.closeButton.onmousedown=t=>t.preventDefault(),this.closeButton.onclick=()=>{this.clear(),this.search.focus()}}clear(){this.search.value="",this.searchList.innerHTML="",this.activeItem=null}cancelDefaultAction(t){(t.key===f.ARROW_DOWN_KEY||t.key===f.ARROW_UP_KEY)&&t.preventDefault()}moveByKeyboard(t){t===f.ARROW_DOWN_KEY||t===f.ARROW_UP_KEY?(this.activeItem?(y(this.activeItem,f.ACTIVE_CLASS),t===f.ARROW_DOWN_KEY?this.activeItem.nextElementSibling?this.activeItem=this.activeItem.nextElementSibling:this.activeItem=this.searchList.firstElementChild:t===f.ARROW_UP_KEY&&(this.activeItem.previousElementSibling?this.activeItem=this.activeItem.previousElementSibling:this.activeItem=this.searchList.lastElementChild)):t===f.ARROW_DOWN_KEY?this.activeItem=this.searchList.firstElementChild:t===f.ARROW_UP_KEY&&(this.activeItem=this.searchList.lastElementChild),O(this.activeItem,f.ACTIVE_CLASS)):t===f.ENTER_KEY?this.activeItem&&this.activeItem.click():t===f.ESCAPE_KEY&&this.isFocused()&&this.search.blur()}isFocused(){return document.activeElement===this.search}onMouseDown(t){this.isFocused()&&(t.preventDefault(),t.button===0&&t.target.click())}searchSeries(){let t=this.search.value.trim().toLowerCase();if(this.searchList.innerHTML="",this.activeItem=null,t.length>0){let e=new Map;for(let r of this.app.containers.values())for(let c of r.map.values()){let d=c.data.name.toLowerCase().search(t);d!==-1&&(e.has(d)||e.set(d,[]),e.get(d).push(c))}e=new Map([...e.entries()].sort());let i=[];for(let r of e.values())r.forEach(c=>i.push(c));let s=Math.min(i.length,f.RESULT_COUNT),a=[];for(let r=0;r<s;r++)a.push(this.createItem(i[r]));this.searchList.append(...a)}}setMouseOverAndOutListener(t){t.addEventListener("mouseover",()=>{y(this.activeItem,f.ACTIVE_CLASS),O(t,f.ACTIVE_CLASS),this.activeItem=t}),t.addEventListener("mouseout",()=>{y(t,f.ACTIVE_CLASS),y(this.activeItem,f.ACTIVE_CLASS),this.activeItem=null})}createItem(t){let e=document.createElement("div");return e.className="search-item",e.onclick=()=>this.onSearchItemClick(t.data.id),e.innerText=t.data.name,this.setMouseOverAndOutListener(e),e}onSearchItemClick(t){this.search.value=this.activeItem.innerText,this.app.onSearchItemClick(t),this.searchList.innerHTML="",this.searchList.append(this.activeItem)}}class ut extends P{constructor(){super("languageDialogTemplate",{closeOnBackdropClick:!0}),this.languageList=document.createElement("div"),this.languageList.id="languageList",this.element.appendChild(this.languageList),this.populateLanguages(),this.setListeners(),window.i18n.applyTo(this.element)}populateLanguages(){const t=window.i18n.getAvailableLanguages(),e=window.i18n.getCurrentLanguage();this.languageList.innerHTML="",t.forEach(i=>{const s=document.createElement("div");s.textContent=window.i18n.t(`lang_${i}`),s.dataset.lang=i,i===e&&s.classList.add("active"),this.languageList.appendChild(s)})}setListeners(){super.setListeners(),this.languageList.addEventListener("click",t=>{const e=t.target.dataset.lang;e&&(window.i18n.setLanguage(e).then(i=>{}),this.close())}),document.addEventListener("languagechange",()=>{this.populateLanguages();const t=window.i18n.getCurrentLanguage();this.languageList.querySelectorAll("[data-lang]").forEach(e=>{e.classList.toggle("active",e.dataset.lang===t)}),window.i18n.applyTo(this.element)})}}class ct{constructor(t){this.app=t,this.search=new f(t),this.languageDialog=new ut,this.boundHandleClick=this.handleDocumentClick.bind(this),this.generate()}getFragment(){return this.header}generate(){const t=document.getElementById("menuTemplate");this.fragment=t.content.cloneNode(!0),this.header=this.fragment.querySelector("header"),this.navbar=this.fragment.querySelector(".navbar"),this.logo=this.fragment.querySelector(".logo"),this.settingsSubMenu=this.fragment.getElementById("settingsSubMenu"),this.settingsSubMenuTitle=this.fragment.getElementById("settingsSubMenuTitle"),this.openAddingElementMenuItem=this.fragment.getElementById("openAddingElementMenuItem"),this.createBackupSubMenuItem=this.fragment.getElementById("createBackupSubMenuItem"),this.loadBackupSubMenuItem=this.fragment.getElementById("loadBackupSubMenuItem"),this.changeLanguageSubMenuItem=this.fragment.getElementById("changeLanguageSubMenuItem"),this.navbar.firstElementChild.insertAdjacentElement("afterend",this.search.getFragment());let e=this.app.localStorage.getNavBarPosition();e&&(this.navbar.style.position=e,this.search.searchList.style.position=e),this.setListeners()}setListeners(){this.logo.onclick=t=>{t.preventDefault(),this.app.refresh()},this.settingsSubMenuTitle.onclick=t=>this.toggleSubMenu(t),document.addEventListener("click",this.boundHandleClick),this.openAddingElementMenuItem.onclick=()=>this.app.openAddingElement(),this.createBackupSubMenuItem.onclick=this.app.backup.getCreateBackupFunction(),this.loadBackupSubMenuItem.onclick=this.app.backup.getLoadBackupFunction(),this.changeLanguageSubMenuItem.onclick=()=>this.languageDialog.open(),this.navbar.addEventListener("dblclick",()=>{let t=this.app.localStorage.getNavBarPosition();t==="absolute"?t="fixed":t="absolute",this.navbar.style.position=t,this.search.searchList.style.position=t,this.app.localStorage.setNavBarPosition(t)})}clear(){this.search.clear()}toggleSubMenu(t){t.stopPropagation(),this.settingsSubMenu.classList.toggle("hide")}hideSubMenu(){g(this.settingsSubMenu)}handleDocumentClick(t){!this.settingsSubMenu.contains(t.target)&&!this.settingsSubMenuTitle.contains(t.target)&&this.hideSubMenu()}}class A{static CONTAINERS_KEY="containers";static NAVBAR_KEY="navbar";clear(){localStorage.clear()}createOrUpdateContainersParams(t){let e;try{e=JSON.parse(localStorage.getItem(A.CONTAINERS_KEY))}catch{}return e||(e={}),e[t]||(e[t]={}),e}getByKey(t){try{return JSON.parse(localStorage.getItem(t))}catch{return null}}setByKey(t,e){localStorage.setItem(t,JSON.stringify(e))}getCountNumberOfContainer(t){try{return this.getByKey(A.CONTAINERS_KEY)[t].count}catch{return null}}setCountNumberOfContainer(t,e){let i=this.createOrUpdateContainersParams(t);i[t].count=e,this.setByKey(A.CONTAINERS_KEY,i)}getGridStateOfContainer(t){try{return this.getByKey(A.CONTAINERS_KEY)[t].grid}catch{return null}}setGridStateOfContainer(t,e){let i=this.createOrUpdateContainersParams(t);i[t].grid=e,this.setByKey(A.CONTAINERS_KEY,i)}getNavBarPosition(){return localStorage.getItem(A.NAVBAR_KEY)}setNavBarPosition(t){localStorage.setItem(A.NAVBAR_KEY,t)}}class D{database;static#t;constructor(){this.database=T.getInstance(),this.containers=new Map,this.localStorage=new A,this.backup=new lt(this.database,()=>this.clearAll(),()=>this.initialize()),_.onItemClickListener=t=>this.openFullitem(t),this.menu=new ct(this),this.addingFullItem=new U(t=>this.relocateSeries(t),this.database),this.main=document.createElement("main"),N("body").append(this.menu.getFragment(),this.main),this.onCreate()}static createApp(){D.#t||(D.#t=new D)}onCreate(){this.database.connect(()=>this.initialize()),this.setDayTimer(),document.addEventListener("languagechange",()=>{this.updateContainerTitles();for(const t of this.containers.values())for(const e of t.map.values())e.retranslate()})}initialize(){const t=new DocumentFragment;t.append(this.addingFullItem.getFragment());for(const e of Object.values(S)){const i=new nt(e,K().get(e),this);this.containers.set(e,i),t.append(i.getFragment())}this.main.append(t),this.database.foreach(e=>this.initialSplitSeries(e),e=>this.onInitialSplitSeriesEnd(e)),D.scrollToTop(),window.i18n.applyTo(document.body)}refresh(){this.menu.clear();for(let t of this.containers.values())t.clear();this.addingFullItem.close(),this.database.foreach(t=>this.initialSplitSeries(t),t=>this.onInitialSplitSeriesEnd(t)),D.scrollToTop()}static scrollToTop(){window.scrollTo({top:0,behavior:"smooth"})}clearAll(){this.clearRuntime(),this.localStorage.clear(),this.database.clear()}clearRuntime(){this.addingFullItem.remove();for(let t of this.containers.values())t.remove();this.containers.clear()}setDayTimer(){let t=new Date;t.setHours(0,0,1),t.setDate(t.getDate()+1),setTimeout(()=>{this.clearRuntime(),this.initialize(),this.setDayTimer()},t-new Date)}openAddingElement(){this.addingFullItem.open()}openFullitem(t){for(let e of this.containers.values())if(e.showFullItemIfExists(t))return}initialSplitSeries(t){t=_.create(t),this.containers.get(M(t)).simplyAddSeries(t)}onInitialSplitSeriesEnd(t){this.addingFullItem.setSeriesId(t+1);for(let e of this.containers.values())e.initialAdditionFinish()}relocateSeries(t,e=null){e||(e=M(t)),this.containers.get(e).addSeries(t)}onSearchItemClick(t){document.activeElement.blur(),this.openFullitem(t)}updateContainerTitles(){const t=K();for(const[e,i]of this.containers.entries())i.updateTitle(t.get(e))}}async function ht(){try{const n=new URL("/SavingSeries/assets/templates-XZ88jK8W.html",import.meta.url).href,e=await(await fetch(n)).text(),i=document.createElement("div");i.innerHTML=e,i.querySelectorAll("template").forEach(a=>{document.body.appendChild(a)})}catch(n){console.error("Error injecting templates:",n)}}async function dt(){await ht(),D.createApp()}dt().then(n=>{});
