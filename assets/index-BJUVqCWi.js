(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();const v={RUN:"0",PAUSE:"1",COMPLETED:"2",JUST_WATCH:"3"},V=[{value:v.RUN,text:"Выходит"},{value:v.PAUSE,text:"На паузе (брошен)"},{value:v.COMPLETED,text:"Просмотрен"},{value:v.JUST_WATCH,text:"Завершился (обычный просмотр)"}];function W(){return V}const m={RELEASED:1,RELEASED_LONG_AGO:2,RELEASED_NEXT_7_DAYS:3,WITH_DATE_OTHERS:4,WITHOUT_DATE:5,ON_PAUSE:6,COMPLETED:7},I=new Map;I.set(m.RELEASED,"Вышедшие");I.set(m.RELEASED_LONG_AGO,"Просматривающиеся");I.set(m.RELEASED_NEXT_7_DAYS,"В течение недели");I.set(m.WITH_DATE_OTHERS,"В ближайшее время");I.set(m.WITHOUT_DATE,"Ожидаются");I.set(m.ON_PAUSE,"Брошены");I.set(m.COMPLETED,"Просмотрены");function k(n){return document.querySelector(n)}function L(n,t){n&&n.classList.add(t)}function p(n,t){n&&n.classList.remove(t)}function d(n){L(n,"hide")}function g(n){p(n,"hide")}function j({duration:n,draw:t,timing:e=s=>s,complete:i=null}){let s=performance.now();requestAnimationFrame(function r(o){let u=(o-s)/n;u>1&&(u=1),t(e(u)),u<1?requestAnimationFrame(r):i&&i()})}function H(n){return n&&n.data.date?n.data.date.toLocaleDateString("ru",{year:"numeric",month:"long",day:"numeric"}):""}function Y(n){return n&&n.data.date?n.data.date.toISOString().split("T")[0]:""}function G(n){return n===""?"":new Date(n)}function J(n){if(n.length>0){let t=document.createElement("a");return t.target="_blank",t.href=n,t.host.length>0&&(t.innerText=t.host),t}else return""}function z(){let n=new Date;return n.setHours(23,59,59,999),n}function q(n){let t;if(n.data.status===v.COMPLETED)t=m.COMPLETED;else if(n.data.status===v.PAUSE)t=m.ON_PAUSE;else if(n.data.status===v.JUST_WATCH)t=m.RELEASED_LONG_AGO;else if(n.data.date==="")t=m.WITHOUT_DATE;else{let e=z();n.data.date<e?t=m.RELEASED:(e.setDate(e.getDate()+7),n.data.date<e?t=m.RELEASED_NEXT_7_DAYS:t=m.WITH_DATE_OTHERS)}return t}function $(n,t){let e;return function(...i){const s=this;clearTimeout(e),e=setTimeout(()=>n.apply(s,i),t)}}class x{constructor(t){this.text=t,this.generate()}open(){return new Promise(t=>{this.showModal?(this.acceptButton.onclick=()=>{this.closeDialog(),t(!0)},this.cancelButton.onclick=()=>{this.closeDialog(),t(!1)},this.dialog.showModal()):t(confirm(this.text))})}generate(){const t=document.getElementById("dialogTemplate");this.fragment=t.content.cloneNode(!0),this.dialog=this.fragment.querySelector("dialog"),typeof this.dialog.showModal=="function"?(this.showModal=!0,this.title=this.fragment.querySelector(".title"),this.acceptButton=this.fragment.querySelector(".accept"),this.cancelButton=this.fragment.querySelector(".cancel"),this.title.innerText=this.text,k("body").append(this.dialog)):this.showModal=!1}closeDialog(){this.dialog.close(),this.dialog.remove()}}class y{static DATABASE_NAME="SavingSeries";static OBJECT_STORE_NAME="series";static#t;constructor(){}static getInstance(){return y.#t||(y.#t=new y),y.#t}connect(t){let e=indexedDB.open(y.DATABASE_NAME,1);e.onsuccess=()=>{this.database=e.result,t()},e.onupgradeneeded=async()=>{const i=()=>indexedDB.deleteDatabase(y.DATABASE_NAME);window.addEventListener("pagehide",i),e.result.createObjectStore(y.OBJECT_STORE_NAME,{keyPath:"id"}),await new x("Данные будут храниться на вашем компьютере").open()?(window.removeEventListener("pagehide",i),this.connect(t)):(window.removeEventListener("pagehide",i),indexedDB.deleteDatabase(y.DATABASE_NAME),alert("Приложение не может работать без доступа к хранилищу"),k("body").style.display="none")}}getObjectStore(t){return this.database.transaction(y.OBJECT_STORE_NAME,t).objectStore(y.OBJECT_STORE_NAME)}getReadWriteObjectStore(){return this.getObjectStore("readwrite")}getReadOnlyObjectStore(){return this.getObjectStore("readonly")}putSeriesInDb(t){return this.getReadWriteObjectStore().put(t.data)}deleteSeriesFromDb(t){return this.getReadWriteObjectStore().delete(t.data.id)}foreach(t,e=null){let i=this.getReadOnlyObjectStore().openCursor(),s=0;i.onsuccess=function(){let r=i.result;r?(t(r.value),s=r.value.id,r.continue()):e&&e(s)}}clear(){this.getReadWriteObjectStore().clear()}}class T{static onItemClickListener=()=>!1;static validate(t){if(t)try{if(t.name!==""){let e=parseInt(t.season),i=parseInt(t.episode);if(e>=1&&e<=50&&i>=1&&i<=5e4)return{id:0,name:t.name,season:e,episode:i,date:t.date!==""?new Date(t.date):"",site:t.site!==""?t.site:"",image:t.image?t.image:"",note:t.note?t.note:"",status:t.status?t.status:v.RUN}}}catch{}return null}static create(t){return new T(t.id,t.name,t.season,t.episode,t.date,t.site,t.image,t.status,t.note)}constructor(t,e,i,s,r,o,u,f,a){this.data={id:t,name:e,season:i,episode:s,date:r,site:o,image:u,status:f,note:a},this.onUpdateListener=null,this.onDeleteListener=null,this.generate()}getFragment(){return this.item}generate(){const t=document.getElementById("seriesTemplate");this.fragment=t.content.cloneNode(!0),this.item=this.fragment.querySelector(".item-outer"),this.item.id=`item${this.data.id}`,this.image=this.fragment.querySelector(".image"),this.image.style.backgroundImage=`url("${this.data.image}")`,this.link=this.fragment.querySelector(".link"),this.data.site&&(this.link.href=this.data.site,g(this.link)),this.info=this.fragment.querySelector(".info"),this.infoSeasonValue=this.info.querySelector(".season > .value"),this.infoEpisodeValue=this.info.querySelector(".episode > .value"),this.infoDate=this.info.querySelector(".date"),this.infoDateValue=this.info.querySelector(".date > .value");const e=this.fragment.querySelector(".name");e.title=this.data.name,e.textContent=this.data.name,this.item.onclick=()=>T.onItemClickListener(this.data.id),this.link.onclick=i=>i.stopPropagation(),this.updateInfo()}updateInfo(){if(this.data.status===v.COMPLETED){d(this.info);return}else g(this.info);if(this.infoSeasonValue.innerText=this.data.season,this.infoEpisodeValue.innerText=this.data.episode,this.data.status===v.JUST_WATCH)d(this.infoDate);else{let t=H(this);t===""?d(this.infoDate):(this.infoDateValue.innerText=t,g(this.infoDate))}}static compressImage(t){let e=document.createElement("img");e.src=t;let i=document.createElement("canvas");return i.width=e.width,i.height=e.height,i.getContext("2d").drawImage(e,0,0),i.toDataURL("image/jpeg",.5)}updateImage(){this.data.image.length>0&&(this.data.image=T.compressImage(this.data.image)),this.image.style.backgroundImage=`url("${this.data.image}")`}updateLink(){this.data.site===""?d(this.link):(this.link.href=this.data.site,g(this.link))}delete(){this.onDeleteListener!==null&&this.onDeleteListener()}remove(){this.item.remove()}compareDates(t,e){return t===""&&e===""?!0:t===""||e===""?!1:t.getTime()===e.getTime()}update(t,e,i,s,r,o,u){let f=!1,a=!1;return this.data.season!==t&&(this.data.season=t,a=!0),this.data.episode!==e&&(this.data.episode=e,a=!0),this.compareDates(this.data.date,i)||(this.data.date=i,f=!0,a=!0),this.data.site!==s&&(this.data.site=s,this.updateLink()),this.data.image!==r&&(this.data.image=r,this.updateImage()),this.data.status!==o&&(this.data.status=o,f=!0),this.data.note!==u&&(this.data.note=u),a&&this.updateInfo(),f&&this.onUpdateListener!==null&&this.onUpdateListener(),f}}function D(n,t){n.oninput=()=>A(n,t)}function A(n,t){let e=n.validity;if(e.valid){p(n,"error"),t.innerText="";return}e.valueMissing?t.innerText="Это поле необходимо заполнить.":e.typeMismatch?n.type==="number"?t.innerText="Пожалуйста, введите число.":n.type==="date"?t.innerText="Пожалуйста, введите корректную дату.":n.type==="url"?t.innerText="Пожалуйста, введите корректный URL.":t.innerText="Пожалуйста, введите правильное значение.":e.rangeUnderflow?t.innerText="Пожалуйста, введите число, большее или равное {0}.".replace("{0}",n.min):e.rangeOverflow?t.innerText="Пожалуйста, введите число, меньшее или равное {0}.".replace("{0}",n.max):e.tooLong?t.innerText="Пожалуйста, введите не более {0} символов.".replace("{0}",n.maxLength):t.innerText="Пожалуйста, введите правильное значение.",L(n,"error")}class B{static ENTER_KEY="Enter";static ESCAPE_KEY="Escape";constructor(t,e=!0){this.id=t,this.needTop=e,this.generate()}getFragment(){return this.fullitem}generate(){const t=document.getElementById("fullitemTemplate");if(this.fragment=t.content.cloneNode(!0),this.fullitem=this.fragment.querySelector(".fullitem"),this.fullitem.id=`fullitem${this.id}`,this.needTop){const s=this.fragment.querySelector(".name-title");s&&(s.id=`nameTitle${this.id}`)}else{const s=this.fragment.querySelector(".top");s&&s.remove()}this.form=this.fragment.querySelector("form"),this.form.id=`form${this.id}`;const e=this.getInputsHtml();e&&this.form.insertAdjacentHTML("afterbegin",e);const i=this.fragment.querySelector(".button-container");i.innerHTML=this.getButtonContainerInnerHtml(),this.getFields(),this.populateStatusOptions(),this.getButtons(),this.setListeners()}populateStatusOptions(){W().forEach(e=>{const i=document.createElement("option");i.value=e.value,i.textContent=e.text,this.fields.status.input.appendChild(i)})}getInputsHtml(){return""}getButtonContainerInnerHtml(){return""}getFields(){this.fields={season:{div:this.fragment.querySelector("input[name='season']").closest(".row"),value:this.fragment.querySelector("input[name='season']").closest(".row").querySelector(".value"),input:this.fragment.querySelector("input[name='season']"),error:this.fragment.querySelector("input[name='season']").closest(".row").querySelector(".error")},episode:{div:this.fragment.querySelector("input[name='episode']").closest(".row"),value:this.fragment.querySelector("input[name='episode']").closest(".row").querySelector(".value"),input:this.fragment.querySelector("input[name='episode']"),error:this.fragment.querySelector("input[name='episode']").closest(".row").querySelector(".error")},date:{div:this.fragment.querySelector("input[name='date']").closest(".row"),value:this.fragment.querySelector("input[name='date']").closest(".row").querySelector(".value"),input:this.fragment.querySelector("input[name='date']"),error:this.fragment.querySelector("input[name='date']").closest(".row").querySelector(".error")},site:{div:this.fragment.querySelector("input[name='site']").closest(".row"),value:this.fragment.querySelector("input[name='site']").closest(".row").querySelector(".value"),input:this.fragment.querySelector("input[name='site']"),error:this.fragment.querySelector("input[name='site']").closest(".row").querySelector(".error")},image:{div:this.fragment.querySelector("input[name='image']").closest(".row"),value:this.fragment.querySelector(".image"),input:this.fragment.querySelector("input[name='image']"),error:this.fragment.querySelector("input[name='image']").closest(".row").querySelector(".error")},status:{div:this.fragment.querySelector("select[name='status']").closest(".row"),input:this.fragment.querySelector("select[name='status']")},note:{div:this.fragment.querySelector("textarea[name='note']").closest(".row"),value:this.fragment.querySelector("textarea[name='note']").closest(".row").querySelector(".value"),input:this.fragment.querySelector("textarea[name='note']")}}}getButtons(){this.buttons={close:{div:this.fragment.querySelector(".outer-close"),button:this.fragment.querySelector(".close")}}}setListeners(){this.form.onsubmit=t=>t.preventDefault(),this.buttons.close.button.onclick=()=>this.close(),this.fields.image.input.onchange=()=>this.changeImage(),this.fields.status.input.onchange=()=>this.onChangeStatus(),this.setValidators()}setValidators(){D(this.fields.season.input,this.fields.season.error),D(this.fields.episode.input,this.fields.episode.error),D(this.fields.date.input,this.fields.date.error),D(this.fields.site.input,this.fields.site.error)}validateInputs(){A(this.fields.season.input,this.fields.season.error),A(this.fields.episode.input,this.fields.episode.error),A(this.fields.date.input,this.fields.date.error),A(this.fields.site.input,this.fields.site.error)}open(){let t=k(`.fullitem:not(.hide):not(#fullitem${this.id})`);d(t),this.resetInputValues(),this.setKeyboardListener(),g(this.fullitem),setTimeout(()=>this.fullitem.scrollIntoView({behavior:"smooth",block:"end"}),35)}setKeyboardListener(){document.onkeyup=t=>this.keyboardListen(t.key)}removeKeyboardListener(){document.onkeyup=null}keyboardListen(t){}clearActiveItem(){p(k(".item-outer.active"),"active")}hide(){d(this.fullitem)}close(){this.removeKeyboardListener(),this.hide()}remove(){this.fullitem.remove()}changeImage(){this.setErrorToImageInput();let t=new FileReader;t.onload=()=>this.fields.image.value.style.backgroundImage=`url(${t.result})`;let e=this.fields.image.input.files[0];e&&(e.type.startsWith("image/")?e.size>10*1024*1024?this.setErrorToImageInput("Размер файла не должен превышать 10 мегабайт."):t.readAsDataURL(e):this.setErrorToImageInput("Выбранный файл не является изображением."))}setErrorToImageInput(t){t?(this.fields.image.error.innerText=t,L(this.fields.image.input,"error")):p(this.fields.image.input,"error")}getStatusState(){let t=this.fields.status.input.value,e={season:!0,episode:!0,date:!0};switch(t){case v.COMPLETED:e.season=!1,e.episode=!1,e.date=!1;break;case v.JUST_WATCH:e.date=!1;break}return e}onChangeStatus(){let t=this.getStatusState();t.season?g(this.fields.season.div):d(this.fields.season.div),t.episode?g(this.fields.episode.div):d(this.fields.episode.div),t.date?g(this.fields.date.div):d(this.fields.date.div)}showEditFields(t){let e=this.fullitem.querySelectorAll(".on-edit"),i=this.fullitem.querySelectorAll(".not-on-edit");t?(e.forEach(s=>g(s)),i.forEach(s=>d(s))):(e.forEach(s=>d(s)),i.forEach(s=>g(s)))}setDisplayValues(t){this.fields.name.value.innerText=t.data.name,this.fields.season.value.innerText=t.data.season,this.fields.episode.value.innerText=t.data.episode,this.fields.date.value.innerText=H(t),this.fields.site.value.innerHTML=J(t.data.site).outerHTML,this.fields.image.value.style.backgroundImage=`url("${t.data.image}")`,this.fields.note.value.innerText=t.data.note}setInputValues(t){this.fields.season.input.value=t.data.season,this.fields.episode.input.value=t.data.episode,this.fields.date.input.value=Y(t),this.fields.site.input.value=t.data.site,this.fields.image.input.value="",this.fields.status.input.value=t.data.status,this.fields.note.input.value=t.data.note}resetInputValues(){this.form.reset(),this.fields.image.value.style.backgroundImage="",p(this.fields.season.input,"error"),p(this.fields.episode.input,"error"),p(this.fields.date.input,"error"),p(this.fields.site.input,"error")}checkInputs(){let t=this.getStatusState();return t.season&&!this.fields.season.input.validity.valid||t.episode&&!this.fields.episode.input.validity.valid||t.date&&!this.fields.date.input.validity.valid?!1:this.fields.site.input.validity.valid&&this.fields.image.input.validity.valid&&this.fields.image.input.validity.valid&&this.fields.status.input.validity.valid&&this.fields.note.input.validity.valid}getValuesFromInputs(){return this.checkInputs()?{season:this.fields.season.input.value,episode:this.fields.episode.input.value,date:G(this.fields.date.input.value),site:this.fields.site.input.value,backgroundImage:this.fields.image.value.style.backgroundImage,status:this.fields.status.input.value,note:this.fields.note.input.value}:null}}class X extends B{constructor(t,e){super(t.id),this.container=t,this.database=e,this.default=!0}getButtonContainerInnerHtml(){return document.getElementById("fullitemButtonsTemplate").innerHTML}getFields(){super.getFields(),this.fields.name={value:this.fragment.querySelector(".name-title")}}getButtons(){super.getButtons(),this.buttons.change={div:this.fragment.querySelector(".change-button"),button:this.fragment.querySelector(".change-button button")},this.buttons.update={div:this.fragment.querySelector(".update-button"),button:this.fragment.querySelector(".update-button button")},this.buttons.cancel={div:this.fragment.querySelector(".cancel-button"),button:this.fragment.querySelector(".cancel-button button")},this.buttons.accept={div:this.fragment.querySelector(".accept-button"),button:this.fragment.querySelector(".accept-button button")},this.buttons.delete={div:this.fragment.querySelector(".delete-button"),button:this.fragment.querySelector(".delete-button button")}}setListeners(){super.setListeners(),this.buttons.change.button.onclick=()=>this.change(),this.buttons.update.button.onclick=()=>this.update(),this.buttons.cancel.button.onclick=()=>this.cancel(),this.buttons.accept.button.onclick=()=>this.accept(),this.buttons.delete.button.onclick=()=>this.delete()}keyboardListen(t){t===B.ENTER_KEY?this.changeMode&&this.accept():t===B.ESCAPE_KEY&&(this.changeMode?this.cancel():this.close())}showAllFields(){this.form.querySelectorAll(".row").forEach(t=>g(t))}hideEmptyFields(){this.series.data.date===""&&d(this.fields.date.div),this.series.data.site===""&&d(this.fields.site.div),this.series.data.note===""&&d(this.fields.note.div),this.series.data.date===""&&this.series.data.status!==v.JUST_WATCH&&d(this.buttons.update.div)}applyUpdateButton(){this.series.data.date===""?this.buttons.update.button.title="Переход к следующей серии":this.buttons.update.button.title="Переход к следующей серии через неделю"}turnOnActiveItem(){this.clearActiveItem(),L(this.series.getFragment(),"active")}needToOpen(t){return!(!this.fullitem.classList.contains("hide")&&this.series&&this.series.data.id===t.data.id)}open(t){this.needToOpen(t)?(this.series=t,this.changeMode=!1,this.moveByGridState(),super.open(),this.setSeries(t),this.turnOnActiveItem(),this.showAllFields(),this.showEditFields(!1),this.onChangeStatus(),this.hideEmptyFields(),this.applyUpdateButton()):this.close()}moveByGridState(){if(this.container.grid){if(this.series){this.default=!1;let t=this.container.hlcList.childNodes,e=Array.from(t),i=e.indexOf(this.fullitem);i>-1&&e.splice(i,1);let s=e.indexOf(this.series.getFragment());s=Math.floor(s/this.container.countNumber)*this.container.countNumber+(this.container.countNumber-1)+(i>-1&&i<=s+(this.container.countNumber-s%this.container.countNumber)?1:0),s>=t.length&&(s=t.length-1),t.item(s).insertAdjacentElement("afterend",this.fullitem)}}else this.moveToDefault()}moveToDefault(){this.default||(this.container.container.append(this.fullitem),this.default=!0)}close(){this.changeMode=!1,this.series=null,super.close(),this.clearActiveItem()}setSeries(t){this.setDisplayValues(t),this.setInputValues(t)}change(){this.changeMode=!0,this.showAllFields(),this.showEditFields(!0),this.onChangeStatus()}update(){let t=this.series.data.date;t!==""&&(t=new Date(this.series.data.date),t.setDate(t.getDate()+7));let e=this.series.update(this.series.data.season,parseInt(this.series.data.episode)+1,t,this.series.data.site,this.series.data.image,this.series.data.status,this.series.data.note);if(this.database.putSeriesInDb(this.series),e&&q(this.series)!==this.id){this.close();return}this.changeMode=!1,this.setDisplayValues(this.series),this.setInputValues(this.series)}cancel(){this.fields.image.value.style.backgroundImage=`url("${this.series.data.image}")`,this.setInputValues(this.series),this.showAllFields(),this.showEditFields(!1),this.onChangeStatus(),this.hideEmptyFields()}accept(){let t=this.getValuesFromInputs();if(!t)return;let e=t.backgroundImage.length>7?t.backgroundImage.slice(5,-2):this.series.data.image,i=this.series.update(t.season,t.episode,t.date,t.site,e,t.status,t.note);if(this.database.putSeriesInDb(this.series),i&&q(this.series)!==this.id){this.close();return}this.changeMode=!1,this.setDisplayValues(this.series),this.showAllFields(),this.showEditFields(!1),this.onChangeStatus(),this.hideEmptyFields(),this.applyUpdateButton()}async delete(){await new x(`Вы действительно хотите удалить "${this.series.data.name}"?`).open()&&(this.series.delete(),this.database.deleteSeriesFromDb(this.series),this.close())}}class M extends B{static seriesId=0;constructor(t,e){super("add",!1),this.showSeries=t,this.database=e}getInputsHtml(){return document.getElementById("fullitemInputsTemplate").innerHTML}getButtonContainerInnerHtml(){return document.getElementById("addingFullitemButtonsTemplate").innerHTML}setSeriesId(t){M.seriesId=t}getFields(){super.getFields(),this.fields.name={input:this.fragment.querySelector("input[name='name']"),error:this.fragment.querySelector("input[name='name']").closest(".row").querySelector(".error")}}getButtons(){super.getButtons(),this.buttons.add={div:this.fragment.querySelector(".add-button"),button:this.fragment.querySelector(".add-button button")}}setListeners(){super.setListeners(),this.buttons.add.button.onclick=()=>this.add()}setValidators(){D(this.fields.name.input,this.fields.name.error),super.setValidators()}validateInputs(){super.validateInputs(),A(this.fields.name.input,this.fields.name.error)}keyboardListen(t){t===B.ENTER_KEY?this.add():t===B.ESCAPE_KEY&&this.close()}resetInputValues(){this.fields.name.input.value="",p(this.fields.name.input,"error"),super.resetInputValues()}open(){this.fullitem.classList.contains("hide")&&(super.open(),this.resetInputValues(),this.showEditFields(!0),this.onChangeStatus(),this.clearActiveItem())}checkInputs(){return this.fields.name.input.validity.valid?super.checkInputs():!1}add(){let t=this.getValuesFromInputs();if(!t){this.validateInputs();return}let e=this.fields.name.input.value,i=t.backgroundImage.length>7?t.backgroundImage.slice(5,-2):"",s=new T(M.seriesId++,e,t.season,t.episode,t.date,t.site,i,t.status,t.note);this.database.putSeriesInDb(s),this.close(),this.showSeries(s)}}class Q{constructor(t,e,i){this.id=t,this.title=e,this.app=i,this.map=new Map,this.countNumber=this.getCountNumberFromLocalStorage(),this.grid=this.getGridStatusFromLocalStorage(),this.fullitem=new X(this,this.app.database),this.generate()}getFragment(){return this.container}generate(){const t=document.getElementById("containerTemplate");this.fragment=t.content.cloneNode(!0),this.container=this.fragment.querySelector(".hlist-container"),this.container.id=`horizontalContainer${this.id}`,this.container.append(this.fullitem.getFragment()),this.container.querySelector(".title").textContent=this.title,this.scrollableList=this.fragment.querySelector(".outer-list"),this.hlcList=this.fragment.querySelector(".list"),this.leftButton=this.fragment.querySelector(".left-control"),this.rightButton=this.fragment.querySelector(".right-control"),this.countButton=this.fragment.querySelector(".count-icon"),this.gridButton=this.fragment.querySelector(".grid-icon"),this.setButtonListeners(),this.updateByCount(),this.turnGridMode(this.grid)}getCountNumberFromLocalStorage(){const t=this.app.localStorage.getCountNumberOfContainer(this.id);return{two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9}[t]||4}setCountToLocalStorage(t){this.app.localStorage.setCountNumberOfContainer(this.id,t)}getGridStatusFromLocalStorage(){return this.app.localStorage.getGridStateOfContainer(this.id)==="true"}setGridStatusToLocalStorage(t){this.app.localStorage.setGridStateOfContainer(this.id,t?"true":"false")}onScrollStopped(t,e,i=300){e.timeout=0,t.onscroll=()=>{let s=Date.now();s-e.timeout>=i&&(e.timeout=s,setTimeout(e,i))}}scrollList(t){let e=this.scrollableList.scrollLeft,i=this.scrollableList.offsetWidth;j({duration:250,draw:s=>t(e,i,s)})}scrollListToLeft(){this.scrollList((t,e,i)=>this.scrollableList.scrollLeft=t-e*i)}scrollListToRight(){this.scrollList((t,e,i)=>this.scrollableList.scrollLeft=t+e*i)}setButtonListeners(){this.onScrollStopped(this.scrollableList,()=>this.checkLeftRightButtons()),this.leftButton.onclick=t=>{t.preventDefault(),this.scrollListToLeft()},this.rightButton.onclick=t=>{t.preventDefault(),this.scrollListToRight()},this.countButton.onclick=()=>{this.countNumber--,this.countNumber===1&&(this.countNumber=9),this.updateByCount()},this.gridButton.onclick=()=>{this.turnGridMode(!this.grid)}}updateByCount(){const e={2:"two",3:"three",4:"four",5:"five",6:"six",7:"seven",8:"eight",9:"nine"}[this.countNumber]||"four";let i=["two","three","four","five","six","seven","eight","nine"];this.countButton.classList.remove(...i),this.countButton.classList.add(e),this.hlcList.classList.remove(...i),this.hlcList.classList.add(e),this.checkLeftRightButtons(),this.fullitem.moveByGridState(),this.setCountToLocalStorage(e)}showGrid(){this.grid=!0,L(this.gridButton,"on"),L(this.hlcList,"grid"),this.showLeftRightButtons(!1),this.fullitem.moveByGridState(),this.setGridStatusToLocalStorage(this.grid)}hideGrid(){this.grid=!1,p(this.gridButton,"on"),p(this.hlcList,"grid"),this.checkLeftRightButtons(),this.fullitem.moveToDefault(),this.setGridStatusToLocalStorage(this.grid)}turnGridMode(t=!1){t?this.showGrid():this.hideGrid()}showLeftRightButtons(t=!0){t?(g(this.leftButton),g(this.rightButton)):(d(this.leftButton),d(this.rightButton))}checkLeftRightButtons(){if(this.grid)return;let t=this.scrollableList.scrollLeft,e=this.scrollableList.scrollWidth-this.scrollableList.clientWidth;t===0?(this.leftButton.classList.add("hide"),e===0?this.rightButton.classList.add("hide"):this.rightButton.classList.remove("hide")):(this.leftButton.classList.remove("hide"),e===t?this.rightButton.classList.add("hide"):this.rightButton.classList.remove("hide"))}show(){g(this.container),this.checkLeftRightButtons()}hide(){d(this.container)}remove(){this.container.remove()}clear(){this.hide();for(let t of this.map.values())t.remove();this.map.clear(),this.fullitem.hide()}simplyAddSeries(t){this.map.set(t.data.id,t),this.setListenersOnSeries(t)}addSeries(t){this.map.size===0&&this.show(),this.simplyAddSeries(t),this.isNeedSortByListType()&&this.sortByDate(),this.showItems(),this.checkLeftRightButtons(),this.scrollFromAnother(t)}sortByDate(){let t=[...this.map.keys()];this.map=new Map([...this.map.entries()].sort((i,s)=>i[1].data.date-s[1].data.date));let e=[...this.map.keys()];for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!0;return!1}isNeedSortByListType(){return this.id===m.RELEASED||this.id===m.RELEASED_NEXT_7_DAYS||this.id===m.WITH_DATE_OTHERS}showItems(){let t=[];for(let e of this.map.values())t.push(e.getFragment());this.hlcList.append(...t)}initialAdditionFinish(){this.isNeedSortByListType()&&this.sortByDate(),this.showItems(),this.map.size>0&&this.show()}setListenersOnSeries(t){t.onUpdateListener=()=>this.onSeriesUpdate(t.data.id),t.onDeleteListener=()=>this.deleteSeries(t)}removeListenersFromSeries(t){t.onUpdateListener=null,t.onDeleteListener=null}onSeriesUpdate(t){let e=this.map.get(t),i=q(e);i!==this.id?(this.deleteSeries(e,!0),this.app.relocateSeries(e,i),setTimeout(()=>this.scrollFromAnother(e),300)):this.isNeedSortByListType()&&this.sortByDate()&&(this.showItems(),this.scrollInThis(e),this.checkLeftRightButtons())}scrollFromAnother(t){t.getFragment().scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}scrollInThis(t){let e=document.documentElement.scrollTop;t.getFragment().scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),document.documentElement.scrollTop=e}deleteSeries(t,e=!1){this.removeListenersFromSeries(t),this.map.delete(t.data.id),e||t.remove(),this.map.size===0?this.hide():this.checkLeftRightButtons()}showFullItemIfExists(t){let e=this.map.get(t);return e?(this.fullitem.open(e),this.scrollInThis(e),!0):!1}}var R=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},C={exports:{}},Z=C.exports,P;function tt(){return P||(P=1,(function(n,t){(function(e,i){i()})(Z,function(){function e(a,l){return typeof l>"u"?l={autoBom:!1}:typeof l!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),l={autoBom:!l}),l.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob(["\uFEFF",a],{type:a.type}):a}function i(a,l,E){var h=new XMLHttpRequest;h.open("GET",a),h.responseType="blob",h.onload=function(){f(h.response,l,E)},h.onerror=function(){console.error("could not download file")},h.send()}function s(a){var l=new XMLHttpRequest;l.open("HEAD",a,!1);try{l.send()}catch{}return 200<=l.status&&299>=l.status}function r(a){try{a.dispatchEvent(new MouseEvent("click"))}catch{var l=document.createEvent("MouseEvents");l.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(l)}}var o=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof R=="object"&&R.global===R?R:void 0,u=o.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),f=o.saveAs||(typeof window!="object"||window!==o?function(){}:"download"in HTMLAnchorElement.prototype&&!u?function(a,l,E){var h=o.URL||o.webkitURL,S=document.createElement("a");l=l||a.name||"download",S.download=l,S.rel="noopener",typeof a=="string"?(S.href=a,S.origin===location.origin?r(S):s(S.href)?i(a,l,E):r(S,S.target="_blank")):(S.href=h.createObjectURL(a),setTimeout(function(){h.revokeObjectURL(S.href)},4e4),setTimeout(function(){r(S)},0))}:"msSaveOrOpenBlob"in navigator?function(a,l,E){if(l=l||a.name||"download",typeof a!="string")navigator.msSaveOrOpenBlob(e(a,E),l);else if(s(a))i(a,l,E);else{var h=document.createElement("a");h.href=a,h.target="_blank",setTimeout(function(){r(h)})}}:function(a,l,E,h){if(h=h||open("","_blank"),h&&(h.document.title=h.document.body.innerText="downloading..."),typeof a=="string")return i(a,l,E);var S=a.type==="application/octet-stream",K=/constructor/i.test(o.HTMLElement)||o.safari,_=/CriOS\/[\d]+/.test(navigator.userAgent);if((_||S&&K||u)&&typeof FileReader<"u"){var N=new FileReader;N.onloadend=function(){var O=N.result;O=_?O:O.replace(/^data:[^;]*;/,"data:attachment/file;"),h?h.location.href=O:location=O,h=null},N.readAsDataURL(a)}else{var U=o.URL||o.webkitURL,F=U.createObjectURL(a);h?h.location=F:location.href=F,h=null,setTimeout(function(){U.revokeObjectURL(F)},4e4)}});o.saveAs=f.saveAs=f,n.exports=f})})(C)),C.exports}var et=tt();class it{constructor(t,e,i){this.database=t,this.clear=e,this.initialize=i}getCreateBackupFunction(){return()=>setTimeout(()=>this.createBackup(),0)}getLoadBackupFunction(){return()=>setTimeout(()=>this.loadBackup(),0)}createBackup(){let t=this.database.getReadOnlyObjectStore().getAll();t.onsuccess=()=>{const e=new Blob([JSON.stringify(t.result)],{type:"text/plain;charset=utf-8"});et.saveAs(e,"SavingSeries.backup")}}async loadBackup(){if(await new x("Все имеющиеся данные будут очищены и заменены на новые").open()){let i=document.createElement("input");i.type="file",i.onchange=s=>this.onOpenFile(s),i.click()}}onOpenFile(t){let e=new FileReader;e.onload=()=>{try{let i=JSON.parse(""+e.result);if(Array.isArray(i)){this.clear();let s=0,r=this.database.getReadWriteObjectStore();for(let o of i){let u=T.validate(o);u&&(u.id=s++,r.add(u))}this.initialize();return}}catch{}alert("Содержимое файла повреждено!")},e.readAsText(t.target.files[0])}}class c{static ACTIVE_CLASS="active";static ARROW_DOWN_KEY="ArrowDown";static ARROW_UP_KEY="ArrowUp";static ENTER_KEY="Enter";static ESCAPE_KEY="Escape";static RESULT_COUNT=10;constructor(t){this.app=t,this.generate()}getFragment(){return this.container}generate(){const t=document.getElementById("searchContainerTemplate");this.fragment=t.content.cloneNode(!0),this.container=this.fragment.querySelector(".search-container"),this.search=this.fragment.querySelector(".search"),this.searchList=this.fragment.querySelector(".search-list"),this.closeButton=this.fragment.querySelector(".close"),this.setListeners(),this.clear()}setListeners(){this.search.oninput=$(()=>this.searchSeries(),200),this.search.onkeydown=t=>this.cancelDefaultAction(t),this.search.onkeyup=t=>this.moveByKeyboard(t.key),this.searchList.onmousedown=t=>this.onMouseDown(t),this.closeButton.onmousedown=t=>t.preventDefault(),this.closeButton.onclick=()=>{this.clear(),this.search.focus()}}clear(){this.search.value="",this.searchList.innerHTML="",this.activeItem=null}cancelDefaultAction(t){(t.key===c.ARROW_DOWN_KEY||t.key===c.ARROW_UP_KEY)&&t.preventDefault()}moveByKeyboard(t){t===c.ARROW_DOWN_KEY||t===c.ARROW_UP_KEY?(this.activeItem?(p(this.activeItem,c.ACTIVE_CLASS),t===c.ARROW_DOWN_KEY?this.activeItem.nextElementSibling?this.activeItem=this.activeItem.nextElementSibling:this.activeItem=this.searchList.firstElementChild:t===c.ARROW_UP_KEY&&(this.activeItem.previousElementSibling?this.activeItem=this.activeItem.previousElementSibling:this.activeItem=this.searchList.lastElementChild)):t===c.ARROW_DOWN_KEY?this.activeItem=this.searchList.firstElementChild:t===c.ARROW_UP_KEY&&(this.activeItem=this.searchList.lastElementChild),L(this.activeItem,c.ACTIVE_CLASS)):t===c.ENTER_KEY?this.activeItem&&this.activeItem.click():t===c.ESCAPE_KEY&&this.isFocused()&&this.search.blur()}isFocused(){return document.activeElement===this.search}onMouseDown(t){this.isFocused()&&(t.preventDefault(),t.button===0&&t.target.click())}searchSeries(){let t=this.search.value.trim().toLowerCase();if(this.searchList.innerHTML="",this.activeItem=null,t.length>0){let e=new Map;for(let o of this.app.containers.values())for(let u of o.map.values()){let f=u.data.name.toLowerCase().search(t);f!==-1&&(e.has(f)||e.set(f,[]),e.get(f).push(u))}e=new Map([...e.entries()].sort());let i=[];for(let o of e.values())o.forEach(u=>i.push(u));let s=Math.min(i.length,c.RESULT_COUNT),r=[];for(let o=0;o<s;o++)r.push(this.createItem(i[o]));this.searchList.append(...r)}}setMouseOverAndOutListener(t){t.addEventListener("mouseover",()=>{p(this.activeItem,c.ACTIVE_CLASS),L(t,c.ACTIVE_CLASS),this.activeItem=t}),t.addEventListener("mouseout",()=>{p(t,c.ACTIVE_CLASS),p(this.activeItem,c.ACTIVE_CLASS),this.activeItem=null})}createItem(t){let e=document.createElement("div");return e.className="search-item",e.onclick=()=>this.onSearchItemClick(t.data.id),e.innerText=t.data.name,this.setMouseOverAndOutListener(e),e}onSearchItemClick(t){this.search.value=this.activeItem.innerText,this.app.onSearchItemClick(t),this.searchList.innerHTML="",this.searchList.append(this.activeItem)}}class st{constructor(t){this.app=t,this.search=new c(t),this.boundHandleClick=this.handleDocumentClick.bind(this),this.generate()}getFragment(){return this.header}generate(){const t=document.getElementById("menuTemplate");this.fragment=t.content.cloneNode(!0),this.header=this.fragment.querySelector("header"),this.navbar=this.fragment.querySelector(".navbar"),this.logo=this.fragment.querySelector(".logo"),this.settingsSubMenu=this.fragment.getElementById("settingsSubMenu"),this.settingsSubMenuTitle=this.fragment.getElementById("settingsSubMenuTitle"),this.openAddingElementMenuItem=this.fragment.getElementById("openAddingElementMenuItem"),this.createBackupSubMenuItem=this.fragment.getElementById("createBackupSubMenuItem"),this.loadBackupSubMenuItem=this.fragment.getElementById("loadBackupSubMenuItem"),this.navbar.firstElementChild.insertAdjacentElement("afterend",this.search.getFragment());let e=this.app.localStorage.getNavBarPosition();e&&(this.navbar.style.position=e,this.search.searchList.style.position=e),this.setListeners()}setListeners(){this.logo.onclick=t=>{t.preventDefault(),this.app.refresh()},this.settingsSubMenuTitle.onclick=t=>this.toggleSubMenu(t),document.addEventListener("click",this.boundHandleClick),this.openAddingElementMenuItem.onclick=()=>this.app.openAddingElement(),this.createBackupSubMenuItem.onclick=this.app.backup.getCreateBackupFunction(),this.loadBackupSubMenuItem.onclick=this.app.backup.getLoadBackupFunction(),this.navbar.addEventListener("dblclick",()=>{let t=this.app.localStorage.getNavBarPosition();t==="absolute"?t="fixed":t="absolute",this.navbar.style.position=t,this.search.searchList.style.position=t,this.app.localStorage.setNavBarPosition(t)})}clear(){this.search.clear()}toggleSubMenu(t){t.stopPropagation(),this.settingsSubMenu.classList.toggle("hide")}hideSubMenu(){d(this.settingsSubMenu)}handleDocumentClick(t){!this.settingsSubMenu.contains(t.target)&&!this.settingsSubMenuTitle.contains(t.target)&&this.hideSubMenu()}}class b{static CONTAINERS_KEY="containers";static NAVBAR_KEY="navbar";clear(){localStorage.clear()}createOrUpdateContainersParams(t){let e;try{e=JSON.parse(localStorage.getItem(b.CONTAINERS_KEY))}catch{}return e||(e={}),e[t]||(e[t]={}),e}getByKey(t){try{return JSON.parse(localStorage.getItem(t))}catch{return null}}setByKey(t,e){localStorage.setItem(t,JSON.stringify(e))}getCountNumberOfContainer(t){try{return this.getByKey(b.CONTAINERS_KEY)[t].count}catch{return null}}setCountNumberOfContainer(t,e){let i=this.createOrUpdateContainersParams(t);i[t].count=e,this.setByKey(b.CONTAINERS_KEY,i)}getGridStateOfContainer(t){try{return this.getByKey(b.CONTAINERS_KEY)[t].grid}catch{return null}}setGridStateOfContainer(t,e){let i=this.createOrUpdateContainersParams(t);i[t].grid=e,this.setByKey(b.CONTAINERS_KEY,i)}getNavBarPosition(){return localStorage.getItem(b.NAVBAR_KEY)}setNavBarPosition(t){localStorage.setItem(b.NAVBAR_KEY,t)}}class w{database;static#t;constructor(){this.database=y.getInstance(),this.containers=new Map,this.localStorage=new b,this.backup=new it(this.database,()=>this.clearAll(),()=>this.initialize()),T.onItemClickListener=t=>this.openFullitem(t),this.menu=new st(this),this.addingFullItem=new M(t=>this.relocateSeries(t),this.database),this.main=document.createElement("main"),k("body").append(this.menu.getFragment(),this.main),this.onCreate()}static createApp(){w.#t||(w.#t=new w)}onCreate(){this.database.connect(()=>this.initialize()),this.setDayTimer()}initialize(){let t=[this.addingFullItem.getFragment()];for(const e of Object.values(m)){let i=new Q(e,I.get(e),this);this.containers.set(e,i),t.push(i.getFragment())}this.main.append(...t),this.database.foreach(e=>this.initialSplitSeries(e),e=>this.onInitialSplitSeriesEnd(e)),w.scrollToTop()}refresh(){this.menu.clear();for(let t of this.containers.values())t.clear();this.addingFullItem.close(),this.database.foreach(t=>this.initialSplitSeries(t),t=>this.onInitialSplitSeriesEnd(t)),w.scrollToTop()}static scrollToTop(){window.scrollTo({top:0,behavior:"smooth"})}clearAll(){this.clearRuntime(),this.localStorage.clear(),this.database.clear()}clearRuntime(){this.addingFullItem.remove();for(let t of this.containers.values())t.remove();this.containers.clear()}setDayTimer(){let t=new Date;t.setHours(0,0,1),t.setDate(t.getDate()+1),setTimeout(()=>{this.clearRuntime(),this.initialize(),this.setDayTimer()},t-new Date)}openAddingElement(){this.addingFullItem.open()}openFullitem(t){for(let e of this.containers.values())if(e.showFullItemIfExists(t))return}initialSplitSeries(t){t=T.create(t),this.containers.get(q(t)).simplyAddSeries(t)}onInitialSplitSeriesEnd(t){this.addingFullItem.setSeriesId(t+1);for(let e of this.containers.values())e.initialAdditionFinish()}relocateSeries(t,e=null){e||(e=q(t)),this.containers.get(e).addSeries(t)}onSearchItemClick(t){document.activeElement.blur(),this.openFullitem(t)}}async function nt(){try{const n=new URL("/SavingSeries/assets/templates-BPBxo1O3.html",import.meta.url).href,e=await(await fetch(n)).text(),i=document.createElement("div");i.innerHTML=e,i.querySelectorAll("template").forEach(r=>{document.body.appendChild(r)})}catch(n){console.error("Error injecting templates:",n)}}async function at(){await nt(),w.createApp()}at().then(n=>{});
