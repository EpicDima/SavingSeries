(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function e(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=e(s);fetch(s.href,a)}})();const $="modulepreload",z=function(n){return"/SavingSeries/"+n},j={},k=function(t,e,i){let s=Promise.resolve();if(e&&e.length>0){let h=function(o){return Promise.all(o.map(u=>Promise.resolve(u).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),l=r?.nonce||r?.getAttribute("nonce");s=h(e.map(o=>{if(o=z(o),o in j)return;j[o]=!0;const u=o.endsWith(".css"),f=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${f}`))return;const c=document.createElement("link");if(c.rel=u?"stylesheet":$,u||(c.as="script"),c.crossOrigin="",c.href=o,l&&c.setAttribute("nonce",l),document.head.appendChild(c),u)return new Promise((v,d)=>{c.addEventListener("load",v),c.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${o}`)))})}))}function a(r){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=r,window.dispatchEvent(l),!l.defaultPrevented)throw r}return s.then(r=>{for(const l of r||[])l.status==="rejected"&&a(l.reason);return t().catch(a)})},V=(n,t,e)=>{const i=n[t];return i?typeof i=="function"?i():Promise.resolve(i):new Promise((s,a)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(a.bind(null,new Error("Unknown variable dynamic import: "+t+(t.split("/").length!==e?". Note that variables only represent file names one level deep.":""))))})};(function(){const n="data-i18n-key",t="data-i18n-title",e="data-i18n-placeholder",s={};let a="en";async function r(d){try{const g=await V(Object.assign({"../locales/en.json":()=>k(()=>import("./en-v_YpiP8R.js"),[]),"../locales/ru.json":()=>k(()=>import("./ru-DmRabVyo.js"),[])}),`../locales/${d}.json`,3);return s[d]=g.default,!0}catch(g){const y=d.split("-")[0];if(y!==d)try{const I=await V(Object.assign({"../locales/en.json":()=>k(()=>import("./en-v_YpiP8R.js"),[]),"../locales/ru.json":()=>k(()=>import("./ru-DmRabVyo.js"),[])}),`../locales/${y}.json`,3);return s[d]=I.default,s[y]=I.default,!0}catch{}return console.error(`Translation file for "${d}" not found, falling back to "en".`,g),d!=="en"&&await r("en"),!1}}function l(d=document){if(!s[a])return;const g=a,y=(b,O,J)=>{if(b.hasAttribute(O)){const P=b.getAttribute(O);s[g]&&s[g][P]&&(b[J]=s[g][P])}};d.querySelectorAll(`[${n}], [${t}], [${e}]`).forEach(b=>{y(b,n,"textContent"),y(b,t,"title"),y(b,e,"placeholder")})}function h(){const d=document.querySelector(`title[${n}]`);if(d){const g=d.getAttribute(n);s[a]&&s[a][g]&&(document.title=s[a][g])}}async function o(d){d===a&&s[d]||(s[d]||await r(d),a=d,document.documentElement.lang=d,l(document.body),h(),localStorage.setItem("preferredLanguage",d),document.dispatchEvent(new CustomEvent("languagechange")))}function u(d,g={}){let y=s[a]?.[d]||d;for(const I in g)y=y.replace(`{${I}}`,g[I]);return y}function f(){return a}function c(){return Object.keys(Object.assign({"../locales/en.json":()=>k(()=>import("./en-v_YpiP8R.js"),[]),"../locales/ru.json":()=>k(()=>import("./ru-DmRabVyo.js"),[])})).map(g=>g.match(/([a-zA-Z-]+)\.json$/)[1])}async function v(){const d=localStorage.getItem("preferredLanguage"),g=navigator.language;await o(d||g||"en")}window.i18n={setLanguage:o,applyTo:l,t:u,init:v,getCurrentLanguage:f,getAvailableLanguages:c},document.addEventListener("DOMContentLoaded",window.i18n.init)})();class m{static DATABASE_NAME="SavingSeries";static#t=2;static#i="series";static SERIES_META_OBJECT_STORE_NAME="series_meta";static SERIES_IMAGES_OBJECT_STORE_NAME="series_images";static#e;constructor(){}static getInstance(){return m.#e||(m.#e=new m),m.#e}connect(t){let e=indexedDB.open(m.DATABASE_NAME,m.#t);e.onsuccess=()=>{this.database=e.result,t()},e.onupgradeneeded=i=>{this.database=i.target.result;const s=i.target.transaction;switch(i.oldVersion){case 0:{this.database.createObjectStore(m.SERIES_META_OBJECT_STORE_NAME,{keyPath:"id"}).createIndex("name_idx","name"),this.database.createObjectStore(m.SERIES_IMAGES_OBJECT_STORE_NAME,{keyPath:"id"});break}case 1:{const a=s.objectStore(m.#i),r=this.database.createObjectStore(m.SERIES_META_OBJECT_STORE_NAME,{keyPath:"id"});r.createIndex("name_idx","name");const l=this.database.createObjectStore(m.SERIES_IMAGES_OBJECT_STORE_NAME,{keyPath:"id"});a.openCursor().onsuccess=h=>{const o=h.target.result;if(o){const{image:u,...f}=o.value;r.add(f),l.add({id:f.id,image:u}),o.continue()}else this.database.deleteObjectStore(m.#i)}}}}}getObjectStore(t,e){return this.database.transaction(t,e).objectStore(t)}getReadWriteObjectStore(t){return this.getObjectStore(t,"readwrite")}getReadOnlyObjectStore(t){return this.getObjectStore(t,"readonly")}async putSeriesInDb(t){const{image:e,...i}=t.data;this.getReadWriteObjectStore(m.SERIES_META_OBJECT_STORE_NAME).put(i),e&&this.getReadWriteObjectStore(m.SERIES_IMAGES_OBJECT_STORE_NAME).put({id:i.id,image:e})}deleteSeriesFromDb(t){this.getReadWriteObjectStore(m.SERIES_META_OBJECT_STORE_NAME).delete(t.data.id),this.getReadWriteObjectStore(m.SERIES_IMAGES_OBJECT_STORE_NAME).delete(t.data.id)}getSeriesImage(t){return new Promise((e,i)=>{const s=this.getReadOnlyObjectStore(m.SERIES_IMAGES_OBJECT_STORE_NAME).get(t);s.onsuccess=a=>{e(a.target.result?.image)},s.onerror=a=>{i(a.target.error)}})}foreach(t,e=null){let i=this.getReadOnlyObjectStore(m.SERIES_META_OBJECT_STORE_NAME).openCursor(),s=0;i.onsuccess=()=>{let a=i.result;a?(t(a.value),s=a.value.id,a.continue()):e&&e(s)}}clear(){this.getReadWriteObjectStore(m.SERIES_META_OBJECT_STORE_NAME).clear(),this.getReadWriteObjectStore(m.SERIES_IMAGES_OBJECT_STORE_NAME).clear()}}const w={RUN:"0",PAUSE:"1",COMPLETED:"2",JUST_WATCH:"3"};function X(){return[{value:w.RUN,text:window.i18n.t("status_run")},{value:w.PAUSE,text:window.i18n.t("status_pause")},{value:w.COMPLETED,text:window.i18n.t("status_completed")},{value:w.JUST_WATCH,text:window.i18n.t("status_just_watch")}]}const E={RELEASED:1,RELEASED_LONG_AGO:2,RELEASED_NEXT_7_DAYS:3,WITH_DATE_OTHERS:4,WITHOUT_DATE:5,ON_PAUSE:6,COMPLETED:7};function G(){const n=new Map;return n.set(E.RELEASED,window.i18n.t("list_name_released")),n.set(E.RELEASED_LONG_AGO,window.i18n.t("list_name_released_long_ago")),n.set(E.RELEASED_NEXT_7_DAYS,window.i18n.t("list_name_released_next_7_days")),n.set(E.WITH_DATE_OTHERS,window.i18n.t("list_name_with_date_others")),n.set(E.WITHOUT_DATE,window.i18n.t("list_name_without_date")),n.set(E.ON_PAUSE,window.i18n.t("list_name_on_pause")),n.set(E.COMPLETED,window.i18n.t("list_name_completed")),n}function N(n){return document.querySelector(n)}function R(n,t){n&&n.classList.add(t)}function L(n,t){n&&n.classList.remove(t)}function S(n){R(n,"hide")}function T(n){L(n,"hide")}function Q({duration:n,draw:t,timing:e=s=>s,complete:i=null}){let s=performance.now();requestAnimationFrame(function a(r){let l=(r-s)/n;l>1&&(l=1),t(e(l)),l<1?requestAnimationFrame(a):i&&i()})}function K(n){return n&&n.data.date?n.data.date.toDate?n.data.date.toDate().toLocaleDateString(window.i18n.getCurrentLanguage(),{year:"numeric",month:"long",day:"numeric"}):n.data.date.toLocaleDateString(window.i18n.getCurrentLanguage(),{year:"numeric",month:"long",day:"numeric"}):""}function Z(n){return n&&n.data.date?n.data.date.toDate?n.data.date.toDate().toISOString().split("T")[0]:n.data.date.toISOString().split("T")[0]:""}function tt(n){return n===""?"":new Date(n)}function et(n){if(n.length>0){let t=document.createElement("a");return t.target="_blank",t.href=n,t.host.length>0&&(t.innerText=t.host),t}else return""}function it(){let n=new Date;return n.setHours(23,59,59,999),n}function q(n){let t;if(n.data.status===w.COMPLETED)t=E.COMPLETED;else if(n.data.status===w.PAUSE)t=E.ON_PAUSE;else if(n.data.status===w.JUST_WATCH)t=E.RELEASED_LONG_AGO;else if(n.data.date==="")t=E.WITHOUT_DATE;else{let e=it();n.data.date<e?t=E.RELEASED:(e.setDate(e.getDate()+7),n.data.date<e?t=E.RELEASED_NEXT_7_DAYS:t=E.WITH_DATE_OTHERS)}return t}function st(n,t){let e;return function(...i){const s=this;clearTimeout(e),e=setTimeout(()=>n.apply(s,i),t)}}class A{static onItemClickListener=()=>!1;static validate(t){if(t)try{if(t.name!==""){let e=parseInt(t.season),i=parseInt(t.episode);if(e>=1&&e<=50&&i>=1&&i<=5e4)return{id:t.id,name:t.name,season:e,episode:i,date:t.date?t.date.toDate?t.date.toDate():new Date(t.date):"",site:t.site?t.site:"",image:t.image||"",note:t.note?t.note:"",status:t.status?t.status:w.RUN}}}catch{}return null}static create(t){const e=A.validate(t);return e?new A(t.id,e.name,e.season,e.episode,e.date,e.site,e.image,e.status,e.note):null}constructor(t,e,i,s,a,r,l,h,o){this.data={id:t,name:e,season:i,episode:s,date:a,site:r,image:l,status:h,note:o},this.onUpdateListener=null,this.onDeleteListener=null,this.generate()}getFragment(){return this.item}generate(){const t=document.getElementById("seriesTemplate");this.fragment=t.content.cloneNode(!0),this.item=this.fragment.querySelector(".item-outer"),this.item.id=`item${this.data.id}`,this.image=this.fragment.querySelector(".image"),this.link=this.fragment.querySelector(".link"),this.data.site&&(this.link.href=this.data.site,T(this.link)),this.info=this.fragment.querySelector(".info"),this.infoSeasonValue=this.info.querySelector(".season > .value"),this.infoEpisodeValue=this.info.querySelector(".episode > .value"),this.infoDate=this.info.querySelector(".date"),this.infoDateValue=this.info.querySelector(".date > .value");const e=this.fragment.querySelector(".name");e.title=this.data.name,e.textContent=this.data.name,this.item.onclick=()=>A.onItemClickListener(this.data.id),this.link.onclick=i=>i.stopPropagation(),this.updateInfo(),window.i18n.applyTo(this.item)}retranslate(){window.i18n.applyTo(this.item),this.updateInfo()}updateInfo(){if(this.data.status===w.COMPLETED){S(this.info);return}else T(this.info);if(this.infoSeasonValue.innerText=this.data.season,this.infoEpisodeValue.innerText=this.data.episode,this.data.status===w.JUST_WATCH)S(this.infoDate);else{let t=K(this);t===""?S(this.infoDate):(this.infoDateValue.innerText=t,T(this.infoDate))}}static async compressImage(t){return new Promise(async(e,i)=>{const s=new Worker(new URL("/SavingSeries/assets/compression.worker-jtAmTRwa.js",import.meta.url));s.onmessage=a=>{const{compressedBlob:r}=a.data,l=new FileReader;l.onloadend=()=>{e(l.result)},l.onerror=i,l.readAsDataURL(r),s.terminate()},s.onerror=a=>{i(a),s.terminate()};try{const r=await(await fetch(t)).blob(),l=await createImageBitmap(r);s.postMessage({imageBitmap:l},[l])}catch(a){i(a)}})}async loadImageAsync(){this.data.image||(this.data.image=await m.getInstance().getSeriesImage(this.data.id),this.data.image&&(this.image.style.backgroundImage=`url("${this.data.image}")`))}async updateImage(){if(this.data.image.length>0)try{this.data.image=await A.compressImage(this.data.image)}catch(t){console.error("Image compression failed:",t)}this.image.style.backgroundImage=`url("${this.data.image}")`}updateLink(){this.data.site===""?S(this.link):(this.link.href=this.data.site,T(this.link))}delete(){this.onDeleteListener!==null&&this.onDeleteListener()}remove(){this.item.remove()}compareDates(t,e){return t===""&&e===""?!0:t===""||e===""?!1:t.getTime()===e.getTime()}async update(t,e,i,s,a,r,l){let h=!1,o=!1;return this.data.season!==t&&(this.data.season=t,o=!0),this.data.episode!==e&&(this.data.episode=e,o=!0),this.compareDates(this.data.date,i)||(this.data.date=i,h=!0,o=!0),this.data.site!==s&&(this.data.site=s,this.updateLink()),this.data.image!==a&&(this.data.image=a,await this.updateImage(),this.image.style.backgroundImage=`url("${this.data.image}")`,h=!0),this.data.status!==r&&(this.data.status=r,h=!0),this.data.note!==l&&(this.data.note=l),o&&this.updateInfo(),h&&this.onUpdateListener!==null&&this.onUpdateListener(),h}}function D(n,t){n.oninput=()=>C(n)}function C(n){const t=n.target;let e=t;for(;e.tagName!=="LABEL";)e=e.parentElement;const i=e.querySelector(".error-message"),s=t.validity;t.classList.remove("invalid"),i.innerText="",!s.valid&&(t.classList.add("invalid"),s.valueMissing?i.innerText=window.i18n.t("validation_field_required"):s.typeMismatch?t.type==="number"?i.innerText=window.i18n.t("validation_enter_number"):t.type==="date"?i.innerText=window.i18n.t("validation_enter_valid_date"):t.type==="url"?i.innerText=window.i18n.t("validation_enter_valid_url"):i.innerText=window.i18n.t("validation_enter_valid_value"):s.rangeUnderflow?i.innerText=window.i18n.t("validation_number_greater_or_equal",{value:t.min}):s.rangeOverflow?i.innerText=window.i18n.t("validation_number_less_or_equal",{value:t.max}):s.tooLong?i.innerText=window.i18n.t("validation_max_length",{value:t.maxLength}):i.innerText=window.i18n.t("validation_enter_valid_value"))}class W{constructor(t,e={}){this.templateId=t,this.options=e,this.generate()}open(){return new Promise(t=>{this.dialog&&typeof this.dialog.showModal=="function"&&(this.dialog.parentElement||N("body").append(this.dialog),this.setListeners(),this.dialog.showModal()),t()})}close(t){this.dialog&&typeof this.dialog.close=="function"&&this.dialog.close(t)}generate(){const t=document.getElementById(this.templateId);if(!t){console.error(`Template with id "${this.templateId}" not found.`);return}const e=t.content.cloneNode(!0);if(this.dialog=e.querySelector("dialog")||e.firstElementChild,!this.dialog){console.error(`No dialog element found in template with id "${this.templateId}".`);return}this.dialog.addEventListener("close",()=>{})}setListeners(){if(this.listenersSet)return;this.dialog.addEventListener("click",e=>{e.target===this.dialog&&this.options.closeOnBackdropClick&&this.close()});const t=this.dialog.querySelector(".close");t&&(t.onclick=()=>this.close()),this.listenersSet=!0}get element(){return this.dialog}}class Y extends W{constructor(t){super("alertDialogTemplate",{closeOnBackdropClick:!0}),this.text=t,this.populate(),this.setListeners(),window.i18n.applyTo(this.element)}open(){return new Promise(t=>{if(this.dialog&&typeof this.dialog.showModal=="function"){const e=()=>{this.dialog.removeEventListener("close",e),t(this.dialog.returnValue==="true")};this.dialog.addEventListener("close",e),this.acceptButton.onclick=()=>this.close("true"),this.cancelButton.onclick=()=>this.close("false"),this.dialog.parentElement||N("body").append(this.dialog),this.dialog.showModal()}else t(confirm(this.text))})}populate(){this.title=this.element.querySelector(".title"),this.acceptButton=this.element.querySelector(".accept"),this.cancelButton=this.element.querySelector(".cancel"),this.title&&(this.title.innerText=this.text)}setListeners(){super.setListeners(),document.addEventListener("languagechange",()=>{this.generate(),window.i18n.applyTo(this.element)})}}class M{static ENTER_KEY="Enter";static ESCAPE_KEY="Escape";constructor(t,e=!0){this.id=t,this.needTop=e,this.generate()}getFragment(){return this.fullitem}generate(){const t=document.getElementById("fullitemTemplate");if(this.fragment=t.content.cloneNode(!0),this.fullitem=this.fragment.querySelector(".fullitem"),this.fullitem.id=`fullitem${this.id}`,this.needTop){const s=this.fragment.querySelector(".name-title");s&&(s.id=`nameTitle${this.id}`)}else{const s=this.fragment.querySelector(".top");s&&s.remove()}this.form=this.fragment.querySelector("form"),this.form.id=`form${this.id}`;const e=this.getInputsHtml();e&&this.form.insertAdjacentHTML("afterbegin",e);const i=this.fragment.querySelector(".button-container");i.innerHTML=this.getButtonContainerInnerHtml(),this.getFields(),this.populateStatusOptions(),this.getButtons(),this.setListeners()}populateStatusOptions(){X().forEach(e=>{const i=document.createElement("option");i.value=e.value,i.textContent=e.text,this.fields.status.input.appendChild(i)})}getInputsHtml(){return""}getButtonContainerInnerHtml(){return""}getFields(){this.fields={season:{div:this.fragment.querySelector("input[name='season']").closest(".row"),value:this.fragment.querySelector("input[name='season']").closest(".row").querySelector(".value"),input:this.fragment.querySelector("input[name='season']"),error:this.fragment.querySelector("input[name='season']").closest(".row").querySelector(".error")},episode:{div:this.fragment.querySelector("input[name='episode']").closest(".row"),value:this.fragment.querySelector("input[name='episode']").closest(".row").querySelector(".value"),input:this.fragment.querySelector("input[name='episode']"),error:this.fragment.querySelector("input[name='episode']").closest(".row").querySelector(".error")},date:{div:this.fragment.querySelector("input[name='date']").closest(".row"),value:this.fragment.querySelector("input[name='date']").closest(".row").querySelector(".value"),input:this.fragment.querySelector("input[name='date']"),error:this.fragment.querySelector("input[name='date']").closest(".row").querySelector(".error")},site:{div:this.fragment.querySelector("input[name='site']").closest(".row"),value:this.fragment.querySelector("input[name='site']").closest(".row").querySelector(".value"),input:this.fragment.querySelector("input[name='site']"),error:this.fragment.querySelector("input[name='site']").closest(".row").querySelector(".error")},image:{div:this.fragment.querySelector("input[name='image']").closest(".row"),value:this.fragment.querySelector(".image"),input:this.fragment.querySelector("input[name='image']"),error:this.fragment.querySelector("input[name='image']").closest(".row").querySelector(".error")},status:{div:this.fragment.querySelector("select[name='status']").closest(".row"),input:this.fragment.querySelector("select[name='status']")},note:{div:this.fragment.querySelector("textarea[name='note']").closest(".row"),value:this.fragment.querySelector("textarea[name='note']").closest(".row").querySelector(".value"),input:this.fragment.querySelector("textarea[name='note']")}}}getButtons(){this.buttons={close:{div:this.fragment.querySelector(".outer-close"),button:this.fragment.querySelector(".close")}}}repopulateStatusOptions(){const t=this.fields.status.input.value;this.fields.status.input.innerHTML="",this.populateStatusOptions(),this.fields.status.input.value=t}setListeners(){this.form.onsubmit=t=>t.preventDefault(),this.buttons.close.button.onclick=()=>this.close(),this.fields.image.input.onchange=()=>this.changeImage(),this.fields.status.input.onchange=()=>this.onChangeStatus(),this.setValidators(),document.addEventListener("languagechange",()=>this.repopulateStatusOptions())}setValidators(){D(this.fields.season.input,this.fields.season.error),D(this.fields.episode.input,this.fields.episode.error),D(this.fields.date.input,this.fields.date.error),D(this.fields.site.input,this.fields.site.error)}validateInputs(){C(this.fields.season.input,this.fields.season.error),C(this.fields.episode.input,this.fields.episode.error),C(this.fields.date.input,this.fields.date.error),C(this.fields.site.input,this.fields.site.error)}open(){let t=N(`.fullitem:not(.hide):not(#fullitem${this.id})`);S(t),this.resetInputValues(),this.setKeyboardListener(),T(this.fullitem),setTimeout(()=>this.fullitem.scrollIntoView({behavior:"smooth",block:"end"}),35)}setKeyboardListener(){document.onkeyup=t=>this.keyboardListen(t.key)}removeKeyboardListener(){document.onkeyup=null}keyboardListen(t){}clearActiveItem(){L(N(".item-outer.active"),"active")}hide(){S(this.fullitem)}close(){this.removeKeyboardListener(),this.hide()}remove(){this.fullitem.remove()}changeImage(){this.setErrorToImageInput();let t=new FileReader;t.onload=()=>this.fields.image.value.style.backgroundImage=`url(${t.result})`;let e=this.fields.image.input.files[0];e&&(e.type.startsWith("image/")?e.size>10*1024*1024?this.setErrorToImageInput(window.i18n.t("file_too_large")):t.readAsDataURL(e):this.setErrorToImageInput(window.i18n.t("not_an_image")))}setErrorToImageInput(t){t?(this.fields.image.error.innerText=t,R(this.fields.image.input,"error")):L(this.fields.image.input,"error")}getStatusState(){let t=this.fields.status.input.value,e={season:!0,episode:!0,date:!0};switch(t){case w.COMPLETED:e.season=!1,e.episode=!1,e.date=!1;break;case w.JUST_WATCH:e.date=!1;break}return e}onChangeStatus(){let t=this.getStatusState();t.season?T(this.fields.season.div):S(this.fields.season.div),t.episode?T(this.fields.episode.div):S(this.fields.episode.div),t.date?T(this.fields.date.div):S(this.fields.date.div)}showEditFields(t){let e=this.fullitem.querySelectorAll(".on-edit"),i=this.fullitem.querySelectorAll(".not-on-edit");t?(e.forEach(s=>T(s)),i.forEach(s=>S(s))):(e.forEach(s=>S(s)),i.forEach(s=>T(s)))}setDisplayValues(t){this.fields.name.value.innerText=t.data.name,this.fields.season.value.innerText=t.data.season,this.fields.episode.value.innerText=t.data.episode,this.fields.date.value.innerText=K(t),this.fields.site.value.innerHTML=et(t.data.site).outerHTML,this.fields.image.value.style.backgroundImage=`url("${t.data.image}")`,this.fields.note.value.innerText=t.data.note}setInputValues(t){this.fields.season.input.value=t.data.season,this.fields.episode.input.value=t.data.episode,this.fields.date.input.value=Z(t),this.fields.site.input.value=t.data.site,this.fields.image.input.value="",this.fields.status.input.value=t.data.status,this.fields.note.input.value=t.data.note}resetInputValues(){this.form.reset(),this.fields.image.value.style.backgroundImage="",L(this.fields.season.input,"error"),L(this.fields.episode.input,"error"),L(this.fields.date.input,"error"),L(this.fields.site.input,"error")}checkInputs(){let t=this.getStatusState();return t.season&&!this.fields.season.input.validity.valid||t.episode&&!this.fields.episode.input.validity.valid||t.date&&!this.fields.date.input.validity.valid?!1:this.fields.site.input.validity.valid&&this.fields.image.input.validity.valid&&this.fields.image.input.validity.valid&&this.fields.status.input.validity.valid&&this.fields.note.input.validity.valid}getValuesFromInputs(){return this.checkInputs()?{season:this.fields.season.input.value,episode:this.fields.episode.input.value,date:tt(this.fields.date.input.value),site:this.fields.site.input.value,backgroundImage:this.fields.image.value.style.backgroundImage,status:this.fields.status.input.value,note:this.fields.note.input.value}:null}}class nt extends M{constructor(t,e){super(t.id),this.container=t,this.database=e,this.default=!0}getButtonContainerInnerHtml(){return document.getElementById("fullitemButtonsTemplate").innerHTML}getFields(){super.getFields(),this.fields.name={value:this.fragment.querySelector(".name-title")}}getButtons(){super.getButtons(),this.buttons.change={div:this.fragment.querySelector(".change-button"),button:this.fragment.querySelector(".change-button button")},this.buttons.update={div:this.fragment.querySelector(".update-button"),button:this.fragment.querySelector(".update-button button")},this.buttons.cancel={div:this.fragment.querySelector(".cancel-button"),button:this.fragment.querySelector(".cancel-button button")},this.buttons.accept={div:this.fragment.querySelector(".accept-button"),button:this.fragment.querySelector(".accept-button button")},this.buttons.delete={div:this.fragment.querySelector(".delete-button"),button:this.fragment.querySelector(".delete-button button")}}setListeners(){super.setListeners(),this.buttons.change.button.onclick=()=>this.change(),this.buttons.update.button.onclick=()=>this.update(),this.buttons.cancel.button.onclick=()=>this.cancel(),this.buttons.accept.button.onclick=()=>this.accept(),this.buttons.delete.button.onclick=()=>this.delete(),document.addEventListener("languagechange",()=>this.repopulateDisplayValues())}repopulateDisplayValues(){this.series&&this.setDisplayValues(this.series)}keyboardListen(t){t===M.ENTER_KEY?this.changeMode&&this.accept():t===M.ESCAPE_KEY&&(this.changeMode?this.cancel():this.close())}showAllFields(){this.form.querySelectorAll(".row").forEach(t=>T(t))}hideEmptyFields(){this.series.data.date===""&&S(this.fields.date.div),this.series.data.site===""&&S(this.fields.site.div),this.series.data.note===""&&S(this.fields.note.div),this.series.data.date===""&&this.series.data.status!==w.JUST_WATCH&&S(this.buttons.update.div)}applyUpdateButton(){this.series.data.date===""?this.buttons.update.button.title=window.i18n.t("next_episode"):this.buttons.update.button.title=window.i18n.t("next_episode_in_a_week")}turnOnActiveItem(){this.clearActiveItem(),R(this.series.getFragment(),"active")}needToOpen(t){return!(!this.fullitem.classList.contains("hide")&&this.series&&this.series.data.id===t.data.id)}open(t){this.needToOpen(t)?(this.series=t,this.changeMode=!1,this.moveByGridState(),super.open(),window.i18n.applyTo(this.fullitem),this.setSeries(t),this.turnOnActiveItem(),this.showAllFields(),this.showEditFields(!1),this.onChangeStatus(),this.hideEmptyFields(),this.applyUpdateButton()):this.close()}moveByGridState(){if(this.container.grid){if(this.series){this.default=!1;let t=this.container.hlcList.childNodes,e=Array.from(t),i=e.indexOf(this.fullitem);i>-1&&e.splice(i,1);let s=e.indexOf(this.series.getFragment());s=Math.floor(s/this.container.countNumber)*this.container.countNumber+(this.container.countNumber-1)+(i>-1&&i<=s+(this.container.countNumber-s%this.container.countNumber)?1:0),s>=t.length&&(s=t.length-1),t.item(s).insertAdjacentElement("afterend",this.fullitem)}}else this.moveToDefault()}moveToDefault(){this.default||(this.container.container.append(this.fullitem),this.default=!0)}close(){this.changeMode=!1,this.series=null,super.close(),this.clearActiveItem()}setSeries(t){this.setDisplayValues(t),this.setInputValues(t)}change(){this.changeMode=!0,this.showAllFields(),this.showEditFields(!0),this.onChangeStatus()}async update(){let t=this.series.data.date;t!==""&&(t=new Date(this.series.data.date),t.setDate(t.getDate()+7));let e=await this.series.update(this.series.data.season,parseInt(this.series.data.episode)+1,t,this.series.data.site,this.series.data.image,this.series.data.status,this.series.data.note);if(this.database.putSeriesInDb(this.series),e&&q(this.series)!==this.id){this.close();return}this.changeMode=!1,this.setDisplayValues(this.series),this.setInputValues(this.series)}cancel(){this.fields.image.value.style.backgroundImage=`url("${this.series.data.image}")`,this.setInputValues(this.series),this.showAllFields(),this.showEditFields(!1),this.onChangeStatus(),this.hideEmptyFields()}async accept(){let t=this.getValuesFromInputs();if(!t)return;let e=t.backgroundImage.length>7?t.backgroundImage.slice(5,-2):this.series.data.image,i=await this.series.update(t.season,t.episode,t.date,t.site,e,t.status,t.note);if(this.database.putSeriesInDb(this.series),i&&q(this.series)!==this.id){this.close();return}this.changeMode=!1,this.setDisplayValues(this.series),this.showAllFields(),this.showEditFields(!1),this.onChangeStatus(),this.hideEmptyFields(),this.applyUpdateButton()}async delete(){await new Y(window.i18n.t("confirm_delete",{name:this.series.data.name})).open()&&(this.series.delete(),this.database.deleteSeriesFromDb(this.series),this.close())}}class U extends M{static seriesId=0;constructor(t,e){super("add",!1),this.showSeries=t,this.database=e}getInputsHtml(){return document.getElementById("fullitemInputsTemplate").innerHTML}getButtonContainerInnerHtml(){return document.getElementById("addingFullitemButtonsTemplate").innerHTML}setSeriesId(t){U.seriesId=t}getFields(){super.getFields(),this.fields.name={input:this.fragment.querySelector("input[name='name']"),error:this.fragment.querySelector("input[name='name']").closest(".row").querySelector(".error")}}getButtons(){super.getButtons(),this.buttons.add={div:this.fragment.querySelector(".add-button"),button:this.fragment.querySelector(".add-button button")}}setListeners(){super.setListeners(),this.buttons.add.button.onclick=()=>this.add()}setValidators(){D(this.fields.name.input,this.fields.name.error),super.setValidators()}validateInputs(){super.validateInputs(),C(this.fields.name.input,this.fields.name.error)}keyboardListen(t){t===M.ENTER_KEY?this.add():t===M.ESCAPE_KEY&&this.close()}resetInputValues(){this.fields.name.input.value="",L(this.fields.name.input,"error"),super.resetInputValues()}open(){this.fullitem.classList.contains("hide")&&(super.open(),window.i18n.applyTo(this.fullitem),this.resetInputValues(),this.showEditFields(!0),this.onChangeStatus(),this.clearActiveItem())}checkInputs(){return this.fields.name.input.validity.valid?super.checkInputs():!1}add(){let t=this.getValuesFromInputs();if(!t){this.validateInputs();return}let e=this.fields.name.input.value,i=t.backgroundImage.length>7?t.backgroundImage.slice(5,-2):"",s=new A(U.seriesId++,e,t.season,t.episode,t.date,t.site,i,t.status,t.note);this.database.putSeriesInDb(s),this.close(),this.showSeries(s)}}class at{constructor(t,e,i){this.id=t,this.title=e,this.app=i,this.map=new Map,this.countNumber=this.getCountNumberFromLocalStorage(),this.grid=this.getGridStatusFromLocalStorage(),this.fullitem=new nt(this,this.app.database),this.generate()}updateTitle(t){this.title=t,this.container.querySelector(".title").textContent=this.title}getFragment(){return this.container}generate(){const t=document.getElementById("containerTemplate");this.fragment=t.content.cloneNode(!0),this.container=this.fragment.querySelector(".hlist-container"),this.container.id=`horizontalContainer${this.id}`,this.container.append(this.fullitem.getFragment()),this.container.querySelector(".title").textContent=this.title,this.scrollableList=this.fragment.querySelector(".outer-list"),this.hlcList=this.fragment.querySelector(".list"),this.leftButton=this.fragment.querySelector(".left-control"),this.rightButton=this.fragment.querySelector(".right-control"),this.countButton=this.fragment.querySelector(".count-icon"),this.gridButton=this.fragment.querySelector(".grid-icon"),this.setButtonListeners(),this.updateByCount(),this.turnGridMode(this.grid)}getCountNumberFromLocalStorage(){const t=this.app.localStorage.getCountNumberOfContainer(this.id);return{two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9}[t]||4}setCountToLocalStorage(t){this.app.localStorage.setCountNumberOfContainer(this.id,t)}getGridStatusFromLocalStorage(){return this.app.localStorage.getGridStateOfContainer(this.id)==="true"}setGridStatusToLocalStorage(t){this.app.localStorage.setGridStateOfContainer(this.id,t?"true":"false")}onScrollStopped(t,e,i=300){e.timeout=0,t.onscroll=()=>{let s=Date.now();s-e.timeout>=i&&(e.timeout=s,setTimeout(e,i))}}scrollList(t){let e=this.scrollableList.scrollLeft,i=this.scrollableList.offsetWidth;Q({duration:250,draw:s=>t(e,i,s)})}scrollListToLeft(){this.scrollList((t,e,i)=>this.scrollableList.scrollLeft=t-e*i)}scrollListToRight(){this.scrollList((t,e,i)=>this.scrollableList.scrollLeft=t+e*i)}setButtonListeners(){this.onScrollStopped(this.scrollableList,()=>this.checkLeftRightButtons()),this.leftButton.onclick=t=>{t.preventDefault(),this.scrollListToLeft()},this.rightButton.onclick=t=>{t.preventDefault(),this.scrollListToRight()},this.countButton.onclick=()=>{this.countNumber--,this.countNumber===1&&(this.countNumber=9),this.updateByCount()},this.gridButton.onclick=()=>{this.turnGridMode(!this.grid)}}updateByCount(){const e={2:"two",3:"three",4:"four",5:"five",6:"six",7:"seven",8:"eight",9:"nine"}[this.countNumber]||"four";let i=["two","three","four","five","six","seven","eight","nine"];this.countButton.classList.remove(...i),this.countButton.classList.add(e),this.hlcList.classList.remove(...i),this.hlcList.classList.add(e),this.checkLeftRightButtons(),this.fullitem.moveByGridState(),this.setCountToLocalStorage(e)}showGrid(){this.grid=!0,R(this.gridButton,"on"),R(this.hlcList,"grid"),this.showLeftRightButtons(!1),this.fullitem.moveByGridState(),this.setGridStatusToLocalStorage(this.grid)}hideGrid(){this.grid=!1,L(this.gridButton,"on"),L(this.hlcList,"grid"),this.checkLeftRightButtons(),this.fullitem.moveToDefault(),this.setGridStatusToLocalStorage(this.grid)}turnGridMode(t=!1){t?this.showGrid():this.hideGrid()}showLeftRightButtons(t=!0){t?(T(this.leftButton),T(this.rightButton)):(S(this.leftButton),S(this.rightButton))}checkLeftRightButtons(){if(this.grid)return;let t=this.scrollableList.scrollLeft,e=this.scrollableList.scrollWidth-this.scrollableList.clientWidth;t===0?(this.leftButton.classList.add("hide"),e===0?this.rightButton.classList.add("hide"):this.rightButton.classList.remove("hide")):(this.leftButton.classList.remove("hide"),e===t?this.rightButton.classList.add("hide"):this.rightButton.classList.remove("hide"))}show(){T(this.container),this.checkLeftRightButtons()}hide(){S(this.container)}remove(){this.container.remove()}clear(){this.hide();for(let t of this.map.values())t.remove();this.map.clear(),this.fullitem.hide()}simplyAddSeries(t){this.map.set(t.data.id,t),this.setListenersOnSeries(t)}addSeries(t){this.map.size===0&&this.show(),this.simplyAddSeries(t),this.isNeedSortByListType()&&this.sortByDate(),this.showItems(),this.checkLeftRightButtons(),this.scrollFromAnother(t),t.updateImage()}sortByDate(){let t=[...this.map.keys()];this.map=new Map([...this.map.entries()].sort((i,s)=>i[1].data.date-s[1].data.date));let e=[...this.map.keys()];for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!0;return!1}isNeedSortByListType(){return this.id===E.RELEASED||this.id===E.RELEASED_NEXT_7_DAYS||this.id===E.WITH_DATE_OTHERS}showItems(){const t=new DocumentFragment;for(const e of this.map.values())t.append(e.getFragment());this.hlcList.append(t)}initialAdditionFinish(){this.isNeedSortByListType()&&this.sortByDate(),this.showItems(),this.map.size>0&&this.show();for(const t of this.map.values())t.loadImageAsync()}setListenersOnSeries(t){t.onUpdateListener=()=>this.onSeriesUpdate(t.data.id),t.onDeleteListener=()=>this.deleteSeries(t)}removeListenersFromSeries(t){t.onUpdateListener=null,t.onDeleteListener=null}onSeriesUpdate(t){let e=this.map.get(t),i=q(e);i!==this.id?(this.deleteSeries(e,!0),this.app.relocateSeries(e,i),setTimeout(()=>this.scrollFromAnother(e),300)):this.isNeedSortByListType()&&this.sortByDate()&&(this.showItems(),this.scrollInThis(e),this.checkLeftRightButtons())}scrollFromAnother(t){t.getFragment().scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}scrollInThis(t){let e=document.documentElement.scrollTop;t.getFragment().scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),document.documentElement.scrollTop=e}deleteSeries(t,e=!1){this.removeListenersFromSeries(t),this.map.delete(t.data.id),e||t.remove(),this.map.size===0?this.hide():this.checkLeftRightButtons()}showFullItemIfExists(t){let e=this.map.get(t);return e?(this.fullitem.open(e),this.scrollInThis(e),!0):!1}}var F=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},x={exports:{}},ot=x.exports,H;function rt(){return H||(H=1,(function(n,t){(function(e,i){i()})(ot,function(){function e(o,u){return typeof u>"u"?u={autoBom:!1}:typeof u!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),u={autoBom:!u}),u.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(o.type)?new Blob(["\uFEFF",o],{type:o.type}):o}function i(o,u,f){var c=new XMLHttpRequest;c.open("GET",o),c.responseType="blob",c.onload=function(){h(c.response,u,f)},c.onerror=function(){console.error("could not download file")},c.send()}function s(o){var u=new XMLHttpRequest;u.open("HEAD",o,!1);try{u.send()}catch{}return 200<=u.status&&299>=u.status}function a(o){try{o.dispatchEvent(new MouseEvent("click"))}catch{var u=document.createEvent("MouseEvents");u.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),o.dispatchEvent(u)}}var r=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof F=="object"&&F.global===F?F:void 0,l=r.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),h=r.saveAs||(typeof window!="object"||window!==r?function(){}:"download"in HTMLAnchorElement.prototype&&!l?function(o,u,f){var c=r.URL||r.webkitURL,v=document.createElement("a");u=u||o.name||"download",v.download=u,v.rel="noopener",typeof o=="string"?(v.href=o,v.origin===location.origin?a(v):s(v.href)?i(o,u,f):a(v,v.target="_blank")):(v.href=c.createObjectURL(o),setTimeout(function(){c.revokeObjectURL(v.href)},4e4),setTimeout(function(){a(v)},0))}:"msSaveOrOpenBlob"in navigator?function(o,u,f){if(u=u||o.name||"download",typeof o!="string")navigator.msSaveOrOpenBlob(e(o,f),u);else if(s(o))i(o,u,f);else{var c=document.createElement("a");c.href=o,c.target="_blank",setTimeout(function(){a(c)})}}:function(o,u,f,c){if(c=c||open("","_blank"),c&&(c.document.title=c.document.body.innerText="downloading..."),typeof o=="string")return i(o,u,f);var v=o.type==="application/octet-stream",d=/constructor/i.test(r.HTMLElement)||r.safari,g=/CriOS\/[\d]+/.test(navigator.userAgent);if((g||v&&d||l)&&typeof FileReader<"u"){var y=new FileReader;y.onloadend=function(){var O=y.result;O=g?O:O.replace(/^data:[^;]*;/,"data:attachment/file;"),c?c.location.href=O:location=O,c=null},y.readAsDataURL(o)}else{var I=r.URL||r.webkitURL,b=I.createObjectURL(o);c?c.location=b:location.href=b,c=null,setTimeout(function(){I.revokeObjectURL(b)},4e4)}});r.saveAs=h.saveAs=h,n.exports=h})})(x)),x.exports}var lt=rt();class ut{constructor(t,e,i){this.database=t,this.clear=e,this.initialize=i}getCreateBackupFunction(){return()=>setTimeout(()=>this.createBackup(),0)}getLoadBackupFunction(){return()=>setTimeout(()=>this.loadBackup(),0)}createBackup(){const t=this.database.getReadOnlyObjectStore(m.SERIES_META_OBJECT_STORE_NAME).getAll();t.onsuccess=()=>{const e=this.database.getReadOnlyObjectStore(m.SERIES_IMAGES_OBJECT_STORE_NAME).getAll();e.onsuccess=()=>{const i=t.result,s=e.result,a=i.map(l=>{const h=s.find(o=>o.id===l.id);return{...l,...h&&{image:h.image}}}),r=new Blob([JSON.stringify(a)],{type:"text/plain;charset=utf-8"});lt.saveAs(r,"SavingSeries.backup")}}}async loadBackup(){if(await new Y(window.i18n.t("backup_load_confirm")).open()){let i=document.createElement("input");i.type="file",i.onchange=s=>this.onOpenFile(s),i.click()}}onOpenFile(t){let e=new FileReader;e.onload=()=>{try{let i=JSON.parse(""+e.result);this.clear();let s=this.database.getReadWriteObjectStore(m.SERIES_META_OBJECT_STORE_NAME),a=this.database.getReadWriteObjectStore(m.SERIES_IMAGES_OBJECT_STORE_NAME);if(Array.isArray(i))for(let r of i){let l=A.validate(r);if(l){const{image:h,...o}=l;s.add(o),h&&a.add({id:o.id,image:h})}}this.initialize();return}catch{}alert(window.i18n.t("backup_file_corrupted"))},e.readAsText(t.target.files[0])}}class p{static ACTIVE_CLASS="active";static ARROW_DOWN_KEY="ArrowDown";static ARROW_UP_KEY="ArrowUp";static ENTER_KEY="Enter";static ESCAPE_KEY="Escape";static RESULT_COUNT=10;constructor(t){this.app=t,this.generate()}getFragment(){return this.container}generate(){const t=document.getElementById("searchContainerTemplate");this.fragment=t.content.cloneNode(!0),this.container=this.fragment.querySelector(".search-container"),this.search=this.fragment.querySelector(".search"),this.searchList=this.fragment.querySelector(".search-list"),this.closeButton=this.fragment.querySelector(".close"),this.setListeners(),this.clear()}setListeners(){this.search.oninput=st(()=>this.searchSeries(),200),this.search.onkeydown=t=>this.cancelDefaultAction(t),this.search.onkeyup=t=>this.moveByKeyboard(t.key),this.searchList.onmousedown=t=>this.onMouseDown(t),this.closeButton.onmousedown=t=>t.preventDefault(),this.closeButton.onclick=()=>{this.clear(),this.search.focus()}}clear(){this.search.value="",this.searchList.innerHTML="",this.activeItem=null}cancelDefaultAction(t){(t.key===p.ARROW_DOWN_KEY||t.key===p.ARROW_UP_KEY)&&t.preventDefault()}moveByKeyboard(t){t===p.ARROW_DOWN_KEY||t===p.ARROW_UP_KEY?(this.activeItem?(L(this.activeItem,p.ACTIVE_CLASS),t===p.ARROW_DOWN_KEY?this.activeItem.nextElementSibling?this.activeItem=this.activeItem.nextElementSibling:this.activeItem=this.searchList.firstElementChild:t===p.ARROW_UP_KEY&&(this.activeItem.previousElementSibling?this.activeItem=this.activeItem.previousElementSibling:this.activeItem=this.searchList.lastElementChild)):t===p.ARROW_DOWN_KEY?this.activeItem=this.searchList.firstElementChild:t===p.ARROW_UP_KEY&&(this.activeItem=this.searchList.lastElementChild),R(this.activeItem,p.ACTIVE_CLASS)):t===p.ENTER_KEY?this.activeItem&&this.activeItem.click():t===p.ESCAPE_KEY&&this.isFocused()&&this.search.blur()}isFocused(){return document.activeElement===this.search}onMouseDown(t){this.isFocused()&&(t.preventDefault(),t.button===0&&t.target.click())}searchSeries(){let t=this.search.value.trim().toLowerCase();if(this.searchList.innerHTML="",this.activeItem=null,t.length>0){let e=new Map;for(let r of this.app.containers.values())for(let l of r.map.values()){let h=l.data.name.toLowerCase().search(t);h!==-1&&(e.has(h)||e.set(h,[]),e.get(h).push(l))}e=new Map([...e.entries()].sort());let i=[];for(let r of e.values())r.forEach(l=>i.push(l));let s=Math.min(i.length,p.RESULT_COUNT),a=[];for(let r=0;r<s;r++)a.push(this.createItem(i[r]));this.searchList.append(...a)}}setMouseOverAndOutListener(t){t.addEventListener("mouseover",()=>{L(this.activeItem,p.ACTIVE_CLASS),R(t,p.ACTIVE_CLASS),this.activeItem=t}),t.addEventListener("mouseout",()=>{L(t,p.ACTIVE_CLASS),L(this.activeItem,p.ACTIVE_CLASS),this.activeItem=null})}createItem(t){let e=document.createElement("div");return e.className="search-item",e.onclick=()=>this.onSearchItemClick(t.data.id),e.innerText=t.data.name,this.setMouseOverAndOutListener(e),e}onSearchItemClick(t){this.search.value=this.activeItem.innerText,this.app.onSearchItemClick(t),this.searchList.innerHTML="",this.searchList.append(this.activeItem)}}class ct extends W{constructor(){super("languageDialogTemplate",{closeOnBackdropClick:!0}),this.languageList=document.createElement("div"),this.languageList.id="languageList",this.element.appendChild(this.languageList),this.populateLanguages(),this.setListeners(),window.i18n.applyTo(this.element)}populateLanguages(){const t=window.i18n.getAvailableLanguages(),e=window.i18n.getCurrentLanguage();this.languageList.innerHTML="",t.forEach(i=>{const s=document.createElement("div");s.textContent=window.i18n.t(`lang_${i}`),s.dataset.lang=i,i===e&&s.classList.add("active"),this.languageList.appendChild(s)})}setListeners(){super.setListeners(),this.languageList.addEventListener("click",t=>{const e=t.target.dataset.lang;e&&(window.i18n.setLanguage(e).then(i=>{}),this.close())}),document.addEventListener("languagechange",()=>{this.populateLanguages();const t=window.i18n.getCurrentLanguage();this.languageList.querySelectorAll("[data-lang]").forEach(e=>{e.classList.toggle("active",e.dataset.lang===t)}),window.i18n.applyTo(this.element)})}}class dt{constructor(t){this.app=t,this.search=new p(t),this.languageDialog=new ct,this.boundHandleClick=this.handleDocumentClick.bind(this),this.generate()}getFragment(){return this.header}generate(){const t=document.getElementById("menuTemplate");this.fragment=t.content.cloneNode(!0),this.header=this.fragment.querySelector("header"),this.navbar=this.fragment.querySelector(".navbar"),this.logo=this.fragment.querySelector(".logo"),this.settingsSubMenu=this.fragment.getElementById("settingsSubMenu"),this.settingsSubMenuTitle=this.fragment.getElementById("settingsSubMenuTitle"),this.openAddingElementMenuItem=this.fragment.getElementById("openAddingElementMenuItem"),this.createBackupSubMenuItem=this.fragment.getElementById("createBackupSubMenuItem"),this.loadBackupSubMenuItem=this.fragment.getElementById("loadBackupSubMenuItem"),this.changeLanguageSubMenuItem=this.fragment.getElementById("changeLanguageSubMenuItem"),this.navbar.firstElementChild.insertAdjacentElement("afterend",this.search.getFragment());let e=this.app.localStorage.getNavBarPosition();e&&(this.navbar.style.position=e,this.search.searchList.style.position=e),this.setListeners()}setListeners(){this.logo.onclick=t=>{t.preventDefault(),this.app.refresh()},this.settingsSubMenuTitle.onclick=t=>this.toggleSubMenu(t),document.addEventListener("click",this.boundHandleClick),this.openAddingElementMenuItem.onclick=()=>this.app.openAddingElement(),this.createBackupSubMenuItem.onclick=this.app.backup.getCreateBackupFunction(),this.loadBackupSubMenuItem.onclick=this.app.backup.getLoadBackupFunction(),this.changeLanguageSubMenuItem.onclick=()=>this.languageDialog.open(),this.navbar.addEventListener("dblclick",()=>{let t=this.app.localStorage.getNavBarPosition();t==="absolute"?t="fixed":t="absolute",this.navbar.style.position=t,this.search.searchList.style.position=t,this.app.localStorage.setNavBarPosition(t)})}clear(){this.search.clear()}toggleSubMenu(t){t.stopPropagation(),this.settingsSubMenu.classList.toggle("hide")}hideSubMenu(){S(this.settingsSubMenu)}handleDocumentClick(t){!this.settingsSubMenu.contains(t.target)&&!this.settingsSubMenuTitle.contains(t.target)&&this.hideSubMenu()}}class _{static CONTAINERS_KEY="containers";static NAVBAR_KEY="navbar";clear(){localStorage.clear()}createOrUpdateContainersParams(t){let e;try{e=JSON.parse(localStorage.getItem(_.CONTAINERS_KEY))}catch{}return e||(e={}),e[t]||(e[t]={}),e}getByKey(t){try{return JSON.parse(localStorage.getItem(t))}catch{return null}}setByKey(t,e){localStorage.setItem(t,JSON.stringify(e))}getCountNumberOfContainer(t){try{return this.getByKey(_.CONTAINERS_KEY)[t].count}catch{return null}}setCountNumberOfContainer(t,e){let i=this.createOrUpdateContainersParams(t);i[t].count=e,this.setByKey(_.CONTAINERS_KEY,i)}getGridStateOfContainer(t){try{return this.getByKey(_.CONTAINERS_KEY)[t].grid}catch{return null}}setGridStateOfContainer(t,e){let i=this.createOrUpdateContainersParams(t);i[t].grid=e,this.setByKey(_.CONTAINERS_KEY,i)}getNavBarPosition(){return localStorage.getItem(_.NAVBAR_KEY)}setNavBarPosition(t){localStorage.setItem(_.NAVBAR_KEY,t)}}class B{database;static#t;constructor(){this.database=m.getInstance(),this.containers=new Map,this.localStorage=new _,this.backup=new ut(this.database,()=>this.clearAll(),()=>this.initialize()),A.onItemClickListener=t=>this.openFullitem(t),this.menu=new dt(this),this.addingFullItem=new U(t=>this.relocateSeries(t),this.database),this.main=document.createElement("main"),N("body").append(this.menu.getFragment(),this.main),this.onCreate()}static createApp(){B.#t||(B.#t=new B)}onCreate(){this.database.connect(()=>this.initialize()),this.setDayTimer(),document.addEventListener("languagechange",()=>{this.updateContainerTitles();for(const t of this.containers.values())for(const e of t.map.values())e.retranslate()})}initialize(){const t=new DocumentFragment;t.append(this.addingFullItem.getFragment());for(const e of Object.values(E)){const i=new at(e,G().get(e),this);this.containers.set(e,i),t.append(i.getFragment())}this.main.append(t),this.database.foreach(e=>this.initialSplitSeries(e),e=>this.onInitialSplitSeriesEnd(e)),B.scrollToTop(),window.i18n.applyTo(document.body)}refresh(){this.menu.clear();for(let t of this.containers.values())t.clear();this.addingFullItem.close(),this.database.foreach(t=>this.initialSplitSeries(t),t=>this.onInitialSplitSeriesEnd(t)),B.scrollToTop()}static scrollToTop(){window.scrollTo({top:0,behavior:"smooth"})}clearAll(){this.clearRuntime(),this.localStorage.clear(),this.database.clear()}clearRuntime(){this.addingFullItem.remove();for(let t of this.containers.values())t.remove();this.containers.clear()}setDayTimer(){let t=new Date;t.setHours(0,0,1),t.setDate(t.getDate()+1),setTimeout(()=>{this.clearRuntime(),this.initialize(),this.setDayTimer()},t-new Date)}openAddingElement(){this.addingFullItem.open()}openFullitem(t){for(let e of this.containers.values())if(e.showFullItemIfExists(t))return}initialSplitSeries(t){t=A.create(t),this.containers.get(q(t)).simplyAddSeries(t)}onInitialSplitSeriesEnd(t){this.addingFullItem.setSeriesId(t+1);for(let e of this.containers.values())e.initialAdditionFinish()}relocateSeries(t,e=null){e||(e=q(t)),this.containers.get(e).addSeries(t)}onSearchItemClick(t){document.activeElement.blur(),this.openFullitem(t)}updateContainerTitles(){const t=G();for(const[e,i]of this.containers.entries())i.updateTitle(t.get(e))}}async function ht(){try{const n=new URL("/SavingSeries/assets/templates-DKCOTXLm.html",import.meta.url).href,e=await(await fetch(n)).text(),i=document.createElement("div");i.innerHTML=e,i.querySelectorAll("template").forEach(a=>{document.body.appendChild(a)})}catch(n){console.error("Error injecting templates:",n)}}async function mt(){await ht(),B.createApp()}mt().then(n=>{});
