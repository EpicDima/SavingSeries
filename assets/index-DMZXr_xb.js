(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();const $="modulepreload",z=function(n){return"/SavingSeries/"+n},V={},C=function(e,t,i){let s=Promise.resolve();if(t&&t.length>0){let m=function(o){return Promise.all(o.map(u=>Promise.resolve(u).then(E=>({status:"fulfilled",value:E}),E=>({status:"rejected",reason:E}))))};document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),l=r?.nonce||r?.getAttribute("nonce");s=m(t.map(o=>{if(o=z(o),o in V)return;V[o]=!0;const u=o.endsWith(".css"),E=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${E}`))return;const c=document.createElement("link");if(c.rel=u?"stylesheet":$,u||(c.as="script"),c.crossOrigin="",c.href=o,l&&c.setAttribute("nonce",l),document.head.appendChild(c),u)return new Promise((v,d)=>{c.addEventListener("load",v),c.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${o}`)))})}))}function a(r){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=r,window.dispatchEvent(l),!l.defaultPrevented)throw r}return s.then(r=>{for(const l of r||[])l.status==="rejected"&&a(l.reason);return e().catch(a)})},G=(n,e,t)=>{const i=n[e];return i?typeof i=="function"?i():Promise.resolve(i):new Promise((s,a)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(a.bind(null,new Error("Unknown variable dynamic import: "+e+(e.split("/").length!==t?". Note that variables only represent file names one level deep.":""))))})};(function(){const n="data-i18n-key",e="data-i18n-title",t="data-i18n-placeholder",s={};let a="en";async function r(d){try{const f=await G(Object.assign({"../locales/en.json":()=>C(()=>import("./en-BKq01Lml.js"),[]),"../locales/ru.json":()=>C(()=>import("./ru-BsMTffaI.js"),[])}),`../locales/${d}.json`,3);return s[d]=f.default,!0}catch(f){const y=d.split("-")[0];if(y!==d)try{const I=await G(Object.assign({"../locales/en.json":()=>C(()=>import("./en-BKq01Lml.js"),[]),"../locales/ru.json":()=>C(()=>import("./ru-BsMTffaI.js"),[])}),`../locales/${y}.json`,3);return s[d]=I.default,s[y]=I.default,!0}catch{}return console.error(`Translation file for "${d}" not found, falling back to "en".`,f),d!=="en"&&await r("en"),!1}}function l(d=document){if(!s[a])return;const f=a,y=(b,O,J)=>{if(b.hasAttribute(O)){const j=b.getAttribute(O);s[f]&&s[f][j]&&(b[J]=s[f][j])}};d.querySelectorAll(`[${n}], [${e}], [${t}]`).forEach(b=>{y(b,n,"textContent"),y(b,e,"title"),y(b,t,"placeholder")})}function m(){const d=document.querySelector(`title[${n}]`);if(d){const f=d.getAttribute(n);s[a]&&s[a][f]&&(document.title=s[a][f])}}async function o(d){d===a&&s[d]||(s[d]||await r(d),a=d,document.documentElement.lang=d,l(document.body),m(),localStorage.setItem("preferredLanguage",d),document.dispatchEvent(new CustomEvent("languagechange")))}function u(d,f={}){let y=s[a]?.[d]||d;for(const I in f)y=y.replace(`{${I}}`,f[I]);return y}function E(){return a}function c(){return Object.keys(Object.assign({"../locales/en.json":()=>C(()=>import("./en-BKq01Lml.js"),[]),"../locales/ru.json":()=>C(()=>import("./ru-BsMTffaI.js"),[])})).map(f=>f.match(/([a-zA-Z-]+)\.json$/)[1])}async function v(){const d=localStorage.getItem("preferredLanguage"),f=navigator.language;await o(d||f||"en")}window.i18n={setLanguage:o,applyTo:l,t:u,init:v,getCurrentLanguage:E,getAvailableLanguages:c},document.addEventListener("DOMContentLoaded",window.i18n.init)})();const T={RUN:"0",PAUSE:"1",COMPLETED:"2",JUST_WATCH:"3"};function X(){return[{value:T.RUN,text:window.i18n.t("status_run")},{value:T.PAUSE,text:window.i18n.t("status_pause")},{value:T.COMPLETED,text:window.i18n.t("status_completed")},{value:T.JUST_WATCH,text:window.i18n.t("status_just_watch")}]}const S={RELEASED:1,RELEASED_LONG_AGO:2,RELEASED_NEXT_7_DAYS:3,WITH_DATE_OTHERS:4,WITHOUT_DATE:5,ON_PAUSE:6,COMPLETED:7};function H(){const n=new Map;return n.set(S.RELEASED,window.i18n.t("list_name_released")),n.set(S.RELEASED_LONG_AGO,window.i18n.t("list_name_released_long_ago")),n.set(S.RELEASED_NEXT_7_DAYS,window.i18n.t("list_name_released_next_7_days")),n.set(S.WITH_DATE_OTHERS,window.i18n.t("list_name_with_date_others")),n.set(S.WITHOUT_DATE,window.i18n.t("list_name_without_date")),n.set(S.ON_PAUSE,window.i18n.t("list_name_on_pause")),n.set(S.COMPLETED,window.i18n.t("list_name_completed")),n}function D(n){return document.querySelector(n)}function R(n,e){n&&n.classList.add(e)}function w(n,e){n&&n.classList.remove(e)}function p(n){R(n,"hide")}function L(n){w(n,"hide")}function Q({duration:n,draw:e,timing:t=s=>s,complete:i=null}){let s=performance.now();requestAnimationFrame(function a(r){let l=(r-s)/n;l>1&&(l=1),e(t(l)),l<1?requestAnimationFrame(a):i&&i()})}function W(n){return n&&n.data.date?n.data.date.toDate?n.data.date.toDate().toLocaleDateString(window.i18n.getCurrentLanguage(),{year:"numeric",month:"long",day:"numeric"}):n.data.date.toLocaleDateString(window.i18n.getCurrentLanguage(),{year:"numeric",month:"long",day:"numeric"}):""}function Z(n){return n&&n.data.date?n.data.date.toDate?n.data.date.toDate().toISOString().split("T")[0]:n.data.date.toISOString().split("T")[0]:""}function ee(n){return n===""?"":new Date(n)}function te(n){if(n.length>0){let e=document.createElement("a");return e.target="_blank",e.href=n,e.host.length>0&&(e.innerText=e.host),e}else return""}function ie(){let n=new Date;return n.setHours(23,59,59,999),n}function q(n){let e;if(n.data.status===T.COMPLETED)e=S.COMPLETED;else if(n.data.status===T.PAUSE)e=S.ON_PAUSE;else if(n.data.status===T.JUST_WATCH)e=S.RELEASED_LONG_AGO;else if(n.data.date==="")e=S.WITHOUT_DATE;else{let t=ie();n.data.date<t?e=S.RELEASED:(t.setDate(t.getDate()+7),n.data.date<t?e=S.RELEASED_NEXT_7_DAYS:e=S.WITH_DATE_OTHERS)}return e}function se(n,e){let t;return function(...i){const s=this;clearTimeout(t),t=setTimeout(()=>n.apply(s,i),e)}}class Y{constructor(e,t={}){this.templateId=e,this.options=t,this.generate()}open(){return new Promise(e=>{this.dialog&&typeof this.dialog.showModal=="function"&&(this.dialog.parentElement||D("body").append(this.dialog),this.setListeners(),this.dialog.showModal()),e()})}close(e){this.dialog&&typeof this.dialog.close=="function"&&this.dialog.close(e)}generate(){const e=document.getElementById(this.templateId);if(!e){console.error(`Template with id "${this.templateId}" not found.`);return}const t=e.content.cloneNode(!0);if(this.dialog=t.querySelector("dialog")||t.firstElementChild,!this.dialog){console.error(`No dialog element found in template with id "${this.templateId}".`);return}this.dialog.addEventListener("close",()=>{})}setListeners(){if(this.listenersSet)return;this.dialog.addEventListener("click",t=>{t.target===this.dialog&&this.options.closeOnBackdropClick&&this.close()});const e=this.dialog.querySelector(".close");e&&(e.onclick=()=>this.close()),this.listenersSet=!0}get element(){return this.dialog}}class P extends Y{constructor(e){super("alertDialogTemplate",{closeOnBackdropClick:!0}),this.text=e,this.populate(),this.setListeners(),window.i18n.applyTo(this.element)}open(){return new Promise(e=>{if(this.dialog&&typeof this.dialog.showModal=="function"){const t=()=>{this.dialog.removeEventListener("close",t),e(this.dialog.returnValue==="true")};this.dialog.addEventListener("close",t),this.acceptButton.onclick=()=>this.close("true"),this.cancelButton.onclick=()=>this.close("false"),this.dialog.parentElement||D("body").append(this.dialog),this.dialog.showModal()}else e(confirm(this.text))})}populate(){this.title=this.element.querySelector(".title"),this.acceptButton=this.element.querySelector(".accept"),this.cancelButton=this.element.querySelector(".cancel"),this.title&&(this.title.innerText=this.text)}setListeners(){super.setListeners(),document.addEventListener("languagechange",()=>{this.generate(),window.i18n.applyTo(this.element)})}}class h{static DATABASE_NAME="SavingSeries";static#e=2;static#i="series";static SERIES_META_OBJECT_STORE_NAME="series_meta";static SERIES_IMAGES_OBJECT_STORE_NAME="series_images";static#t;constructor(){}static getInstance(){return h.#t||(h.#t=new h),h.#t}connect(e){let t=indexedDB.open(h.DATABASE_NAME,h.#e);t.onsuccess=()=>{this.database=t.result,e()},t.onupgradeneeded=async i=>{if(this.database=i.target.result,i.oldVersion<2){const s=i.target.transaction.objectStore(h.#i),a=this.database.createObjectStore(h.SERIES_META_OBJECT_STORE_NAME,{keyPath:"id"});a.createIndex("name_idx","name");const r=this.database.createObjectStore(h.SERIES_IMAGES_OBJECT_STORE_NAME,{keyPath:"id"});s.openCursor().onsuccess=l=>{const m=l.target.result;if(m){const{image:o,...u}=m.value;a.add(u),r.add({id:u.id,image:o}),m.continue()}else this.database.deleteObjectStore(h.#i)}}else{const s=()=>indexedDB.deleteDatabase(h.DATABASE_NAME);window.addEventListener("pagehide",s),this.database.createObjectStore(h.SERIES_META_OBJECT_STORE_NAME,{keyPath:"id"}),this.database.createObjectStore(h.SERIES_IMAGES_OBJECT_STORE_NAME,{keyPath:"id"}),await new P(window.i18n.t("database_store_on_computer")).open()?(window.removeEventListener("pagehide",s),this.connect(e)):(window.removeEventListener("pagehide",s),indexedDB.deleteDatabase(h.DATABASE_NAME),alert(window.i18n.t("database_no_access")),D("body").style.display="none")}}}getObjectStore(e,t){return this.database.transaction(e,t).objectStore(e)}getReadWriteObjectStore(e){return this.getObjectStore(e,"readwrite")}getReadOnlyObjectStore(e){return this.getObjectStore(e,"readonly")}async putSeriesInDb(e){const{image:t,...i}=e.data;this.getReadWriteObjectStore(h.SERIES_META_OBJECT_STORE_NAME).put(i),t&&this.getReadWriteObjectStore(h.SERIES_IMAGES_OBJECT_STORE_NAME).put({id:i.id,image:t})}deleteSeriesFromDb(e){this.getReadWriteObjectStore(h.SERIES_META_OBJECT_STORE_NAME).delete(e.data.id),this.getReadWriteObjectStore(h.SERIES_IMAGES_OBJECT_STORE_NAME).delete(e.data.id)}getSeriesImage(e){return new Promise((t,i)=>{const s=this.getReadOnlyObjectStore(h.SERIES_IMAGES_OBJECT_STORE_NAME).get(e);s.onsuccess=a=>{t(a.target.result?.image)},s.onerror=a=>{i(a.target.error)}})}foreach(e,t=null){let i=this.getReadOnlyObjectStore(h.SERIES_META_OBJECT_STORE_NAME).openCursor(),s=0;i.onsuccess=()=>{let a=i.result;a?(e(a.value),s=a.value.id,a.continue()):t&&t(s)}}clear(){this.getReadWriteObjectStore(h.SERIES_META_OBJECT_STORE_NAME).clear(),this.getReadWriteObjectStore(h.SERIES_IMAGES_OBJECT_STORE_NAME).clear()}}class A{static onItemClickListener=()=>!1;static validate(e){if(e)try{if(e.name!==""){let t=parseInt(e.season),i=parseInt(e.episode);if(t>=1&&t<=50&&i>=1&&i<=5e4)return{id:e.id,name:e.name,season:t,episode:i,date:e.date?e.date.toDate?e.date.toDate():new Date(e.date):"",site:e.site?e.site:"",image:e.image||"",note:e.note?e.note:"",status:e.status?e.status:T.RUN}}}catch{}return null}static create(e){const t=A.validate(e);return t?new A(e.id,t.name,t.season,t.episode,t.date,t.site,t.image,t.status,t.note):null}constructor(e,t,i,s,a,r,l,m,o){this.data={id:e,name:t,season:i,episode:s,date:a,site:r,image:l,status:m,note:o},this.onUpdateListener=null,this.onDeleteListener=null,this.generate()}getFragment(){return this.item}generate(){const e=document.getElementById("seriesTemplate");this.fragment=e.content.cloneNode(!0),this.item=this.fragment.querySelector(".item-outer"),this.item.id=`item${this.data.id}`,this.image=this.fragment.querySelector(".image"),this.link=this.fragment.querySelector(".link"),this.data.site&&(this.link.href=this.data.site,L(this.link)),this.info=this.fragment.querySelector(".info"),this.infoSeasonValue=this.info.querySelector(".season > .value"),this.infoEpisodeValue=this.info.querySelector(".episode > .value"),this.infoDate=this.info.querySelector(".date"),this.infoDateValue=this.info.querySelector(".date > .value");const t=this.fragment.querySelector(".name");t.title=this.data.name,t.textContent=this.data.name,this.item.onclick=()=>A.onItemClickListener(this.data.id),this.link.onclick=i=>i.stopPropagation(),this.updateInfo(),window.i18n.applyTo(this.item)}retranslate(){window.i18n.applyTo(this.item),this.updateInfo()}updateInfo(){if(this.data.status===T.COMPLETED){p(this.info);return}else L(this.info);if(this.infoSeasonValue.innerText=this.data.season,this.infoEpisodeValue.innerText=this.data.episode,this.data.status===T.JUST_WATCH)p(this.infoDate);else{let e=W(this);e===""?p(this.infoDate):(this.infoDateValue.innerText=e,L(this.infoDate))}}static async compressImage(e){return new Promise(async(t,i)=>{const s=new Worker(new URL("/SavingSeries/assets/compression.worker-jtAmTRwa.js",import.meta.url));s.onmessage=a=>{const{compressedBlob:r}=a.data,l=new FileReader;l.onloadend=()=>{t(l.result)},l.onerror=i,l.readAsDataURL(r),s.terminate()},s.onerror=a=>{i(a),s.terminate()};try{const r=await(await fetch(e)).blob(),l=await createImageBitmap(r);s.postMessage({imageBitmap:l},[l])}catch(a){i(a)}})}async loadImageAsync(){this.data.image||(this.data.image=await h.getInstance().getSeriesImage(this.data.id),this.data.image&&(this.image.style.backgroundImage=`url("${this.data.image}")`))}async updateImage(){if(this.data.image.length>0)try{this.data.image=await A.compressImage(this.data.image)}catch(e){console.error("Image compression failed:",e)}this.image.style.backgroundImage=`url("${this.data.image}")`}updateLink(){this.data.site===""?p(this.link):(this.link.href=this.data.site,L(this.link))}delete(){this.onDeleteListener!==null&&this.onDeleteListener()}remove(){this.item.remove()}compareDates(e,t){return e===""&&t===""?!0:e===""||t===""?!1:e.getTime()===t.getTime()}async update(e,t,i,s,a,r,l){let m=!1,o=!1;return this.data.season!==e&&(this.data.season=e,o=!0),this.data.episode!==t&&(this.data.episode=t,o=!0),this.compareDates(this.data.date,i)||(this.data.date=i,m=!0,o=!0),this.data.site!==s&&(this.data.site=s,this.updateLink()),this.data.image!==a&&(this.data.image=a,await this.updateImage(),this.image.style.backgroundImage=`url("${this.data.image}")`,m=!0),this.data.status!==r&&(this.data.status=r,m=!0),this.data.note!==l&&(this.data.note=l),o&&this.updateInfo(),m&&this.onUpdateListener!==null&&this.onUpdateListener(),m}}function N(n,e){n.oninput=()=>M(n)}function M(n){const e=n.target;let t=e;for(;t.tagName!=="LABEL";)t=t.parentElement;const i=t.querySelector(".error-message"),s=e.validity;e.classList.remove("invalid"),i.innerText="",!s.valid&&(e.classList.add("invalid"),s.valueMissing?i.innerText=window.i18n.t("validation_field_required"):s.typeMismatch?e.type==="number"?i.innerText=window.i18n.t("validation_enter_number"):e.type==="date"?i.innerText=window.i18n.t("validation_enter_valid_date"):e.type==="url"?i.innerText=window.i18n.t("validation_enter_valid_url"):i.innerText=window.i18n.t("validation_enter_valid_value"):s.rangeUnderflow?i.innerText=window.i18n.t("validation_number_greater_or_equal",{value:e.min}):s.rangeOverflow?i.innerText=window.i18n.t("validation_number_less_or_equal",{value:e.max}):s.tooLong?i.innerText=window.i18n.t("validation_max_length",{value:e.maxLength}):i.innerText=window.i18n.t("validation_enter_valid_value"))}class k{static ENTER_KEY="Enter";static ESCAPE_KEY="Escape";constructor(e,t=!0){this.id=e,this.needTop=t,this.generate()}getFragment(){return this.fullitem}generate(){const e=document.getElementById("fullitemTemplate");if(this.fragment=e.content.cloneNode(!0),this.fullitem=this.fragment.querySelector(".fullitem"),this.fullitem.id=`fullitem${this.id}`,this.needTop){const s=this.fragment.querySelector(".name-title");s&&(s.id=`nameTitle${this.id}`)}else{const s=this.fragment.querySelector(".top");s&&s.remove()}this.form=this.fragment.querySelector("form"),this.form.id=`form${this.id}`;const t=this.getInputsHtml();t&&this.form.insertAdjacentHTML("afterbegin",t);const i=this.fragment.querySelector(".button-container");i.innerHTML=this.getButtonContainerInnerHtml(),this.getFields(),this.populateStatusOptions(),this.getButtons(),this.setListeners()}populateStatusOptions(){X().forEach(t=>{const i=document.createElement("option");i.value=t.value,i.textContent=t.text,this.fields.status.input.appendChild(i)})}getInputsHtml(){return""}getButtonContainerInnerHtml(){return""}getFields(){this.fields={season:{div:this.fragment.querySelector("input[name='season']").closest(".row"),value:this.fragment.querySelector("input[name='season']").closest(".row").querySelector(".value"),input:this.fragment.querySelector("input[name='season']"),error:this.fragment.querySelector("input[name='season']").closest(".row").querySelector(".error")},episode:{div:this.fragment.querySelector("input[name='episode']").closest(".row"),value:this.fragment.querySelector("input[name='episode']").closest(".row").querySelector(".value"),input:this.fragment.querySelector("input[name='episode']"),error:this.fragment.querySelector("input[name='episode']").closest(".row").querySelector(".error")},date:{div:this.fragment.querySelector("input[name='date']").closest(".row"),value:this.fragment.querySelector("input[name='date']").closest(".row").querySelector(".value"),input:this.fragment.querySelector("input[name='date']"),error:this.fragment.querySelector("input[name='date']").closest(".row").querySelector(".error")},site:{div:this.fragment.querySelector("input[name='site']").closest(".row"),value:this.fragment.querySelector("input[name='site']").closest(".row").querySelector(".value"),input:this.fragment.querySelector("input[name='site']"),error:this.fragment.querySelector("input[name='site']").closest(".row").querySelector(".error")},image:{div:this.fragment.querySelector("input[name='image']").closest(".row"),value:this.fragment.querySelector(".image"),input:this.fragment.querySelector("input[name='image']"),error:this.fragment.querySelector("input[name='image']").closest(".row").querySelector(".error")},status:{div:this.fragment.querySelector("select[name='status']").closest(".row"),input:this.fragment.querySelector("select[name='status']")},note:{div:this.fragment.querySelector("textarea[name='note']").closest(".row"),value:this.fragment.querySelector("textarea[name='note']").closest(".row").querySelector(".value"),input:this.fragment.querySelector("textarea[name='note']")}}}getButtons(){this.buttons={close:{div:this.fragment.querySelector(".outer-close"),button:this.fragment.querySelector(".close")}}}repopulateStatusOptions(){const e=this.fields.status.input.value;this.fields.status.input.innerHTML="",this.populateStatusOptions(),this.fields.status.input.value=e}setListeners(){this.form.onsubmit=e=>e.preventDefault(),this.buttons.close.button.onclick=()=>this.close(),this.fields.image.input.onchange=()=>this.changeImage(),this.fields.status.input.onchange=()=>this.onChangeStatus(),this.setValidators(),document.addEventListener("languagechange",()=>this.repopulateStatusOptions())}setValidators(){N(this.fields.season.input,this.fields.season.error),N(this.fields.episode.input,this.fields.episode.error),N(this.fields.date.input,this.fields.date.error),N(this.fields.site.input,this.fields.site.error)}validateInputs(){M(this.fields.season.input,this.fields.season.error),M(this.fields.episode.input,this.fields.episode.error),M(this.fields.date.input,this.fields.date.error),M(this.fields.site.input,this.fields.site.error)}open(){let e=D(`.fullitem:not(.hide):not(#fullitem${this.id})`);p(e),this.resetInputValues(),this.setKeyboardListener(),L(this.fullitem),setTimeout(()=>this.fullitem.scrollIntoView({behavior:"smooth",block:"end"}),35)}setKeyboardListener(){document.onkeyup=e=>this.keyboardListen(e.key)}removeKeyboardListener(){document.onkeyup=null}keyboardListen(e){}clearActiveItem(){w(D(".item-outer.active"),"active")}hide(){p(this.fullitem)}close(){this.removeKeyboardListener(),this.hide()}remove(){this.fullitem.remove()}changeImage(){this.setErrorToImageInput();let e=new FileReader;e.onload=()=>this.fields.image.value.style.backgroundImage=`url(${e.result})`;let t=this.fields.image.input.files[0];t&&(t.type.startsWith("image/")?t.size>10*1024*1024?this.setErrorToImageInput(window.i18n.t("file_too_large")):e.readAsDataURL(t):this.setErrorToImageInput(window.i18n.t("not_an_image")))}setErrorToImageInput(e){e?(this.fields.image.error.innerText=e,R(this.fields.image.input,"error")):w(this.fields.image.input,"error")}getStatusState(){let e=this.fields.status.input.value,t={season:!0,episode:!0,date:!0};switch(e){case T.COMPLETED:t.season=!1,t.episode=!1,t.date=!1;break;case T.JUST_WATCH:t.date=!1;break}return t}onChangeStatus(){let e=this.getStatusState();e.season?L(this.fields.season.div):p(this.fields.season.div),e.episode?L(this.fields.episode.div):p(this.fields.episode.div),e.date?L(this.fields.date.div):p(this.fields.date.div)}showEditFields(e){let t=this.fullitem.querySelectorAll(".on-edit"),i=this.fullitem.querySelectorAll(".not-on-edit");e?(t.forEach(s=>L(s)),i.forEach(s=>p(s))):(t.forEach(s=>p(s)),i.forEach(s=>L(s)))}setDisplayValues(e){this.fields.name.value.innerText=e.data.name,this.fields.season.value.innerText=e.data.season,this.fields.episode.value.innerText=e.data.episode,this.fields.date.value.innerText=W(e),this.fields.site.value.innerHTML=te(e.data.site).outerHTML,this.fields.image.value.style.backgroundImage=`url("${e.data.image}")`,this.fields.note.value.innerText=e.data.note}setInputValues(e){this.fields.season.input.value=e.data.season,this.fields.episode.input.value=e.data.episode,this.fields.date.input.value=Z(e),this.fields.site.input.value=e.data.site,this.fields.image.input.value="",this.fields.status.input.value=e.data.status,this.fields.note.input.value=e.data.note}resetInputValues(){this.form.reset(),this.fields.image.value.style.backgroundImage="",w(this.fields.season.input,"error"),w(this.fields.episode.input,"error"),w(this.fields.date.input,"error"),w(this.fields.site.input,"error")}checkInputs(){let e=this.getStatusState();return e.season&&!this.fields.season.input.validity.valid||e.episode&&!this.fields.episode.input.validity.valid||e.date&&!this.fields.date.input.validity.valid?!1:this.fields.site.input.validity.valid&&this.fields.image.input.validity.valid&&this.fields.image.input.validity.valid&&this.fields.status.input.validity.valid&&this.fields.note.input.validity.valid}getValuesFromInputs(){return this.checkInputs()?{season:this.fields.season.input.value,episode:this.fields.episode.input.value,date:ee(this.fields.date.input.value),site:this.fields.site.input.value,backgroundImage:this.fields.image.value.style.backgroundImage,status:this.fields.status.input.value,note:this.fields.note.input.value}:null}}class ne extends k{constructor(e,t){super(e.id),this.container=e,this.database=t,this.default=!0}getButtonContainerInnerHtml(){return document.getElementById("fullitemButtonsTemplate").innerHTML}getFields(){super.getFields(),this.fields.name={value:this.fragment.querySelector(".name-title")}}getButtons(){super.getButtons(),this.buttons.change={div:this.fragment.querySelector(".change-button"),button:this.fragment.querySelector(".change-button button")},this.buttons.update={div:this.fragment.querySelector(".update-button"),button:this.fragment.querySelector(".update-button button")},this.buttons.cancel={div:this.fragment.querySelector(".cancel-button"),button:this.fragment.querySelector(".cancel-button button")},this.buttons.accept={div:this.fragment.querySelector(".accept-button"),button:this.fragment.querySelector(".accept-button button")},this.buttons.delete={div:this.fragment.querySelector(".delete-button"),button:this.fragment.querySelector(".delete-button button")}}setListeners(){super.setListeners(),this.buttons.change.button.onclick=()=>this.change(),this.buttons.update.button.onclick=()=>this.update(),this.buttons.cancel.button.onclick=()=>this.cancel(),this.buttons.accept.button.onclick=()=>this.accept(),this.buttons.delete.button.onclick=()=>this.delete(),document.addEventListener("languagechange",()=>this.repopulateDisplayValues())}repopulateDisplayValues(){this.series&&this.setDisplayValues(this.series)}keyboardListen(e){e===k.ENTER_KEY?this.changeMode&&this.accept():e===k.ESCAPE_KEY&&(this.changeMode?this.cancel():this.close())}showAllFields(){this.form.querySelectorAll(".row").forEach(e=>L(e))}hideEmptyFields(){this.series.data.date===""&&p(this.fields.date.div),this.series.data.site===""&&p(this.fields.site.div),this.series.data.note===""&&p(this.fields.note.div),this.series.data.date===""&&this.series.data.status!==T.JUST_WATCH&&p(this.buttons.update.div)}applyUpdateButton(){this.series.data.date===""?this.buttons.update.button.title=window.i18n.t("next_episode"):this.buttons.update.button.title=window.i18n.t("next_episode_in_a_week")}turnOnActiveItem(){this.clearActiveItem(),R(this.series.getFragment(),"active")}needToOpen(e){return!(!this.fullitem.classList.contains("hide")&&this.series&&this.series.data.id===e.data.id)}open(e){this.needToOpen(e)?(this.series=e,this.changeMode=!1,this.moveByGridState(),super.open(),window.i18n.applyTo(this.fullitem),this.setSeries(e),this.turnOnActiveItem(),this.showAllFields(),this.showEditFields(!1),this.onChangeStatus(),this.hideEmptyFields(),this.applyUpdateButton()):this.close()}moveByGridState(){if(this.container.grid){if(this.series){this.default=!1;let e=this.container.hlcList.childNodes,t=Array.from(e),i=t.indexOf(this.fullitem);i>-1&&t.splice(i,1);let s=t.indexOf(this.series.getFragment());s=Math.floor(s/this.container.countNumber)*this.container.countNumber+(this.container.countNumber-1)+(i>-1&&i<=s+(this.container.countNumber-s%this.container.countNumber)?1:0),s>=e.length&&(s=e.length-1),e.item(s).insertAdjacentElement("afterend",this.fullitem)}}else this.moveToDefault()}moveToDefault(){this.default||(this.container.container.append(this.fullitem),this.default=!0)}close(){this.changeMode=!1,this.series=null,super.close(),this.clearActiveItem()}setSeries(e){this.setDisplayValues(e),this.setInputValues(e)}change(){this.changeMode=!0,this.showAllFields(),this.showEditFields(!0),this.onChangeStatus()}async update(){let e=this.series.data.date;e!==""&&(e=new Date(this.series.data.date),e.setDate(e.getDate()+7));let t=await this.series.update(this.series.data.season,parseInt(this.series.data.episode)+1,e,this.series.data.site,this.series.data.image,this.series.data.status,this.series.data.note);if(this.database.putSeriesInDb(this.series),t&&q(this.series)!==this.id){this.close();return}this.changeMode=!1,this.setDisplayValues(this.series),this.setInputValues(this.series)}cancel(){this.fields.image.value.style.backgroundImage=`url("${this.series.data.image}")`,this.setInputValues(this.series),this.showAllFields(),this.showEditFields(!1),this.onChangeStatus(),this.hideEmptyFields()}async accept(){let e=this.getValuesFromInputs();if(!e)return;let t=e.backgroundImage.length>7?e.backgroundImage.slice(5,-2):this.series.data.image,i=await this.series.update(e.season,e.episode,e.date,e.site,t,e.status,e.note);if(this.database.putSeriesInDb(this.series),i&&q(this.series)!==this.id){this.close();return}this.changeMode=!1,this.setDisplayValues(this.series),this.showAllFields(),this.showEditFields(!1),this.onChangeStatus(),this.hideEmptyFields(),this.applyUpdateButton()}async delete(){await new P(window.i18n.t("confirm_delete",{name:this.series.data.name})).open()&&(this.series.delete(),this.database.deleteSeriesFromDb(this.series),this.close())}}class U extends k{static seriesId=0;constructor(e,t){super("add",!1),this.showSeries=e,this.database=t}getInputsHtml(){return document.getElementById("fullitemInputsTemplate").innerHTML}getButtonContainerInnerHtml(){return document.getElementById("addingFullitemButtonsTemplate").innerHTML}setSeriesId(e){U.seriesId=e}getFields(){super.getFields(),this.fields.name={input:this.fragment.querySelector("input[name='name']"),error:this.fragment.querySelector("input[name='name']").closest(".row").querySelector(".error")}}getButtons(){super.getButtons(),this.buttons.add={div:this.fragment.querySelector(".add-button"),button:this.fragment.querySelector(".add-button button")}}setListeners(){super.setListeners(),this.buttons.add.button.onclick=()=>this.add()}setValidators(){N(this.fields.name.input,this.fields.name.error),super.setValidators()}validateInputs(){super.validateInputs(),M(this.fields.name.input,this.fields.name.error)}keyboardListen(e){e===k.ENTER_KEY?this.add():e===k.ESCAPE_KEY&&this.close()}resetInputValues(){this.fields.name.input.value="",w(this.fields.name.input,"error"),super.resetInputValues()}open(){this.fullitem.classList.contains("hide")&&(super.open(),window.i18n.applyTo(this.fullitem),this.resetInputValues(),this.showEditFields(!0),this.onChangeStatus(),this.clearActiveItem())}checkInputs(){return this.fields.name.input.validity.valid?super.checkInputs():!1}add(){let e=this.getValuesFromInputs();if(!e){this.validateInputs();return}let t=this.fields.name.input.value,i=e.backgroundImage.length>7?e.backgroundImage.slice(5,-2):"",s=new A(U.seriesId++,t,e.season,e.episode,e.date,e.site,i,e.status,e.note);this.database.putSeriesInDb(s),this.close(),this.showSeries(s)}}class ae{constructor(e,t,i){this.id=e,this.title=t,this.app=i,this.map=new Map,this.countNumber=this.getCountNumberFromLocalStorage(),this.grid=this.getGridStatusFromLocalStorage(),this.fullitem=new ne(this,this.app.database),this.generate()}updateTitle(e){this.title=e,this.container.querySelector(".title").textContent=this.title}getFragment(){return this.container}generate(){const e=document.getElementById("containerTemplate");this.fragment=e.content.cloneNode(!0),this.container=this.fragment.querySelector(".hlist-container"),this.container.id=`horizontalContainer${this.id}`,this.container.append(this.fullitem.getFragment()),this.container.querySelector(".title").textContent=this.title,this.scrollableList=this.fragment.querySelector(".outer-list"),this.hlcList=this.fragment.querySelector(".list"),this.leftButton=this.fragment.querySelector(".left-control"),this.rightButton=this.fragment.querySelector(".right-control"),this.countButton=this.fragment.querySelector(".count-icon"),this.gridButton=this.fragment.querySelector(".grid-icon"),this.setButtonListeners(),this.updateByCount(),this.turnGridMode(this.grid)}getCountNumberFromLocalStorage(){const e=this.app.localStorage.getCountNumberOfContainer(this.id);return{two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9}[e]||4}setCountToLocalStorage(e){this.app.localStorage.setCountNumberOfContainer(this.id,e)}getGridStatusFromLocalStorage(){return this.app.localStorage.getGridStateOfContainer(this.id)==="true"}setGridStatusToLocalStorage(e){this.app.localStorage.setGridStateOfContainer(this.id,e?"true":"false")}onScrollStopped(e,t,i=300){t.timeout=0,e.onscroll=()=>{let s=Date.now();s-t.timeout>=i&&(t.timeout=s,setTimeout(t,i))}}scrollList(e){let t=this.scrollableList.scrollLeft,i=this.scrollableList.offsetWidth;Q({duration:250,draw:s=>e(t,i,s)})}scrollListToLeft(){this.scrollList((e,t,i)=>this.scrollableList.scrollLeft=e-t*i)}scrollListToRight(){this.scrollList((e,t,i)=>this.scrollableList.scrollLeft=e+t*i)}setButtonListeners(){this.onScrollStopped(this.scrollableList,()=>this.checkLeftRightButtons()),this.leftButton.onclick=e=>{e.preventDefault(),this.scrollListToLeft()},this.rightButton.onclick=e=>{e.preventDefault(),this.scrollListToRight()},this.countButton.onclick=()=>{this.countNumber--,this.countNumber===1&&(this.countNumber=9),this.updateByCount()},this.gridButton.onclick=()=>{this.turnGridMode(!this.grid)}}updateByCount(){const t={2:"two",3:"three",4:"four",5:"five",6:"six",7:"seven",8:"eight",9:"nine"}[this.countNumber]||"four";let i=["two","three","four","five","six","seven","eight","nine"];this.countButton.classList.remove(...i),this.countButton.classList.add(t),this.hlcList.classList.remove(...i),this.hlcList.classList.add(t),this.checkLeftRightButtons(),this.fullitem.moveByGridState(),this.setCountToLocalStorage(t)}showGrid(){this.grid=!0,R(this.gridButton,"on"),R(this.hlcList,"grid"),this.showLeftRightButtons(!1),this.fullitem.moveByGridState(),this.setGridStatusToLocalStorage(this.grid)}hideGrid(){this.grid=!1,w(this.gridButton,"on"),w(this.hlcList,"grid"),this.checkLeftRightButtons(),this.fullitem.moveToDefault(),this.setGridStatusToLocalStorage(this.grid)}turnGridMode(e=!1){e?this.showGrid():this.hideGrid()}showLeftRightButtons(e=!0){e?(L(this.leftButton),L(this.rightButton)):(p(this.leftButton),p(this.rightButton))}checkLeftRightButtons(){if(this.grid)return;let e=this.scrollableList.scrollLeft,t=this.scrollableList.scrollWidth-this.scrollableList.clientWidth;e===0?(this.leftButton.classList.add("hide"),t===0?this.rightButton.classList.add("hide"):this.rightButton.classList.remove("hide")):(this.leftButton.classList.remove("hide"),t===e?this.rightButton.classList.add("hide"):this.rightButton.classList.remove("hide"))}show(){L(this.container),this.checkLeftRightButtons()}hide(){p(this.container)}remove(){this.container.remove()}clear(){this.hide();for(let e of this.map.values())e.remove();this.map.clear(),this.fullitem.hide()}simplyAddSeries(e){this.map.set(e.data.id,e),this.setListenersOnSeries(e)}addSeries(e){this.map.size===0&&this.show(),this.simplyAddSeries(e),this.isNeedSortByListType()&&this.sortByDate(),this.showItems(),this.checkLeftRightButtons(),this.scrollFromAnother(e),e.updateImage()}sortByDate(){let e=[...this.map.keys()];this.map=new Map([...this.map.entries()].sort((i,s)=>i[1].data.date-s[1].data.date));let t=[...this.map.keys()];for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!0;return!1}isNeedSortByListType(){return this.id===S.RELEASED||this.id===S.RELEASED_NEXT_7_DAYS||this.id===S.WITH_DATE_OTHERS}showItems(){const e=new DocumentFragment;for(const t of this.map.values())e.append(t.getFragment());this.hlcList.append(e)}initialAdditionFinish(){this.isNeedSortByListType()&&this.sortByDate(),this.showItems(),this.map.size>0&&this.show();for(const e of this.map.values())e.loadImageAsync()}setListenersOnSeries(e){e.onUpdateListener=()=>this.onSeriesUpdate(e.data.id),e.onDeleteListener=()=>this.deleteSeries(e)}removeListenersFromSeries(e){e.onUpdateListener=null,e.onDeleteListener=null}onSeriesUpdate(e){let t=this.map.get(e),i=q(t);i!==this.id?(this.deleteSeries(t,!0),this.app.relocateSeries(t,i),setTimeout(()=>this.scrollFromAnother(t),300)):this.isNeedSortByListType()&&this.sortByDate()&&(this.showItems(),this.scrollInThis(t),this.checkLeftRightButtons())}scrollFromAnother(e){e.getFragment().scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}scrollInThis(e){let t=document.documentElement.scrollTop;e.getFragment().scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),document.documentElement.scrollTop=t}deleteSeries(e,t=!1){this.removeListenersFromSeries(e),this.map.delete(e.data.id),t||e.remove(),this.map.size===0?this.hide():this.checkLeftRightButtons()}showFullItemIfExists(e){let t=this.map.get(e);return t?(this.fullitem.open(t),this.scrollInThis(t),!0):!1}}var F=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},x={exports:{}},oe=x.exports,K;function re(){return K||(K=1,(function(n,e){(function(t,i){i()})(oe,function(){function t(o,u){return typeof u>"u"?u={autoBom:!1}:typeof u!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),u={autoBom:!u}),u.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(o.type)?new Blob(["\uFEFF",o],{type:o.type}):o}function i(o,u,E){var c=new XMLHttpRequest;c.open("GET",o),c.responseType="blob",c.onload=function(){m(c.response,u,E)},c.onerror=function(){console.error("could not download file")},c.send()}function s(o){var u=new XMLHttpRequest;u.open("HEAD",o,!1);try{u.send()}catch{}return 200<=u.status&&299>=u.status}function a(o){try{o.dispatchEvent(new MouseEvent("click"))}catch{var u=document.createEvent("MouseEvents");u.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),o.dispatchEvent(u)}}var r=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof F=="object"&&F.global===F?F:void 0,l=r.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),m=r.saveAs||(typeof window!="object"||window!==r?function(){}:"download"in HTMLAnchorElement.prototype&&!l?function(o,u,E){var c=r.URL||r.webkitURL,v=document.createElement("a");u=u||o.name||"download",v.download=u,v.rel="noopener",typeof o=="string"?(v.href=o,v.origin===location.origin?a(v):s(v.href)?i(o,u,E):a(v,v.target="_blank")):(v.href=c.createObjectURL(o),setTimeout(function(){c.revokeObjectURL(v.href)},4e4),setTimeout(function(){a(v)},0))}:"msSaveOrOpenBlob"in navigator?function(o,u,E){if(u=u||o.name||"download",typeof o!="string")navigator.msSaveOrOpenBlob(t(o,E),u);else if(s(o))i(o,u,E);else{var c=document.createElement("a");c.href=o,c.target="_blank",setTimeout(function(){a(c)})}}:function(o,u,E,c){if(c=c||open("","_blank"),c&&(c.document.title=c.document.body.innerText="downloading..."),typeof o=="string")return i(o,u,E);var v=o.type==="application/octet-stream",d=/constructor/i.test(r.HTMLElement)||r.safari,f=/CriOS\/[\d]+/.test(navigator.userAgent);if((f||v&&d||l)&&typeof FileReader<"u"){var y=new FileReader;y.onloadend=function(){var O=y.result;O=f?O:O.replace(/^data:[^;]*;/,"data:attachment/file;"),c?c.location.href=O:location=O,c=null},y.readAsDataURL(o)}else{var I=r.URL||r.webkitURL,b=I.createObjectURL(o);c?c.location=b:location.href=b,c=null,setTimeout(function(){I.revokeObjectURL(b)},4e4)}});r.saveAs=m.saveAs=m,n.exports=m})})(x)),x.exports}var le=re();class ue{constructor(e,t,i){this.database=e,this.clear=t,this.initialize=i}getCreateBackupFunction(){return()=>setTimeout(()=>this.createBackup(),0)}getLoadBackupFunction(){return()=>setTimeout(()=>this.loadBackup(),0)}createBackup(){const e=this.database.getReadOnlyObjectStore(h.SERIES_META_OBJECT_STORE_NAME).getAll();e.onsuccess=()=>{const t=this.database.getReadOnlyObjectStore(h.SERIES_IMAGES_OBJECT_STORE_NAME).getAll();t.onsuccess=()=>{const i=e.result.map(a=>{const r=t.result.find(l=>l.id===a.id);return{...a,image:r?.image}}),s=new Blob([JSON.stringify(i)],{type:"text/plain;charset=utf-8"});le.saveAs(s,"SavingSeries.backup")}}}async loadBackup(){if(await new P(window.i18n.t("backup_load_confirm")).open()){let i=document.createElement("input");i.type="file",i.onchange=s=>this.onOpenFile(s),i.click()}}onOpenFile(e){let t=new FileReader;t.onload=()=>{try{let i=JSON.parse(""+t.result);if(Array.isArray(i)){this.clear();let s=this.database.getReadWriteObjectStore(h.SERIES_META_OBJECT_STORE_NAME),a=this.database.getReadWriteObjectStore(h.SERIES_IMAGES_OBJECT_STORE_NAME);for(let r of i){let l=A.validate(r);if(l){const{image:m,...o}=l;s.add(o),m&&a.add({id:o.id,image:m})}}this.initialize();return}}catch{}alert(window.i18n.t("backup_file_corrupted"))},t.readAsText(e.target.files[0])}}class g{static ACTIVE_CLASS="active";static ARROW_DOWN_KEY="ArrowDown";static ARROW_UP_KEY="ArrowUp";static ENTER_KEY="Enter";static ESCAPE_KEY="Escape";static RESULT_COUNT=10;constructor(e){this.app=e,this.generate()}getFragment(){return this.container}generate(){const e=document.getElementById("searchContainerTemplate");this.fragment=e.content.cloneNode(!0),this.container=this.fragment.querySelector(".search-container"),this.search=this.fragment.querySelector(".search"),this.searchList=this.fragment.querySelector(".search-list"),this.closeButton=this.fragment.querySelector(".close"),this.setListeners(),this.clear()}setListeners(){this.search.oninput=se(()=>this.searchSeries(),200),this.search.onkeydown=e=>this.cancelDefaultAction(e),this.search.onkeyup=e=>this.moveByKeyboard(e.key),this.searchList.onmousedown=e=>this.onMouseDown(e),this.closeButton.onmousedown=e=>e.preventDefault(),this.closeButton.onclick=()=>{this.clear(),this.search.focus()}}clear(){this.search.value="",this.searchList.innerHTML="",this.activeItem=null}cancelDefaultAction(e){(e.key===g.ARROW_DOWN_KEY||e.key===g.ARROW_UP_KEY)&&e.preventDefault()}moveByKeyboard(e){e===g.ARROW_DOWN_KEY||e===g.ARROW_UP_KEY?(this.activeItem?(w(this.activeItem,g.ACTIVE_CLASS),e===g.ARROW_DOWN_KEY?this.activeItem.nextElementSibling?this.activeItem=this.activeItem.nextElementSibling:this.activeItem=this.searchList.firstElementChild:e===g.ARROW_UP_KEY&&(this.activeItem.previousElementSibling?this.activeItem=this.activeItem.previousElementSibling:this.activeItem=this.searchList.lastElementChild)):e===g.ARROW_DOWN_KEY?this.activeItem=this.searchList.firstElementChild:e===g.ARROW_UP_KEY&&(this.activeItem=this.searchList.lastElementChild),R(this.activeItem,g.ACTIVE_CLASS)):e===g.ENTER_KEY?this.activeItem&&this.activeItem.click():e===g.ESCAPE_KEY&&this.isFocused()&&this.search.blur()}isFocused(){return document.activeElement===this.search}onMouseDown(e){this.isFocused()&&(e.preventDefault(),e.button===0&&e.target.click())}searchSeries(){let e=this.search.value.trim().toLowerCase();if(this.searchList.innerHTML="",this.activeItem=null,e.length>0){let t=new Map;for(let r of this.app.containers.values())for(let l of r.map.values()){let m=l.data.name.toLowerCase().search(e);m!==-1&&(t.has(m)||t.set(m,[]),t.get(m).push(l))}t=new Map([...t.entries()].sort());let i=[];for(let r of t.values())r.forEach(l=>i.push(l));let s=Math.min(i.length,g.RESULT_COUNT),a=[];for(let r=0;r<s;r++)a.push(this.createItem(i[r]));this.searchList.append(...a)}}setMouseOverAndOutListener(e){e.addEventListener("mouseover",()=>{w(this.activeItem,g.ACTIVE_CLASS),R(e,g.ACTIVE_CLASS),this.activeItem=e}),e.addEventListener("mouseout",()=>{w(e,g.ACTIVE_CLASS),w(this.activeItem,g.ACTIVE_CLASS),this.activeItem=null})}createItem(e){let t=document.createElement("div");return t.className="search-item",t.onclick=()=>this.onSearchItemClick(e.data.id),t.innerText=e.data.name,this.setMouseOverAndOutListener(t),t}onSearchItemClick(e){this.search.value=this.activeItem.innerText,this.app.onSearchItemClick(e),this.searchList.innerHTML="",this.searchList.append(this.activeItem)}}class ce extends Y{constructor(){super("languageDialogTemplate",{closeOnBackdropClick:!0}),this.languageList=document.createElement("div"),this.languageList.id="languageList",this.element.appendChild(this.languageList),this.populateLanguages(),this.setListeners(),window.i18n.applyTo(this.element)}populateLanguages(){const e=window.i18n.getAvailableLanguages(),t=window.i18n.getCurrentLanguage();this.languageList.innerHTML="",e.forEach(i=>{const s=document.createElement("div");s.textContent=window.i18n.t(`lang_${i}`),s.dataset.lang=i,i===t&&s.classList.add("active"),this.languageList.appendChild(s)})}setListeners(){super.setListeners(),this.languageList.addEventListener("click",e=>{const t=e.target.dataset.lang;t&&(window.i18n.setLanguage(t).then(i=>{}),this.close())}),document.addEventListener("languagechange",()=>{this.populateLanguages();const e=window.i18n.getCurrentLanguage();this.languageList.querySelectorAll("[data-lang]").forEach(t=>{t.classList.toggle("active",t.dataset.lang===e)}),window.i18n.applyTo(this.element)})}}class de{constructor(e){this.app=e,this.search=new g(e),this.languageDialog=new ce,this.boundHandleClick=this.handleDocumentClick.bind(this),this.generate()}getFragment(){return this.header}generate(){const e=document.getElementById("menuTemplate");this.fragment=e.content.cloneNode(!0),this.header=this.fragment.querySelector("header"),this.navbar=this.fragment.querySelector(".navbar"),this.logo=this.fragment.querySelector(".logo"),this.settingsSubMenu=this.fragment.getElementById("settingsSubMenu"),this.settingsSubMenuTitle=this.fragment.getElementById("settingsSubMenuTitle"),this.openAddingElementMenuItem=this.fragment.getElementById("openAddingElementMenuItem"),this.createBackupSubMenuItem=this.fragment.getElementById("createBackupSubMenuItem"),this.loadBackupSubMenuItem=this.fragment.getElementById("loadBackupSubMenuItem"),this.changeLanguageSubMenuItem=this.fragment.getElementById("changeLanguageSubMenuItem"),this.navbar.firstElementChild.insertAdjacentElement("afterend",this.search.getFragment());let t=this.app.localStorage.getNavBarPosition();t&&(this.navbar.style.position=t,this.search.searchList.style.position=t),this.setListeners()}setListeners(){this.logo.onclick=e=>{e.preventDefault(),this.app.refresh()},this.settingsSubMenuTitle.onclick=e=>this.toggleSubMenu(e),document.addEventListener("click",this.boundHandleClick),this.openAddingElementMenuItem.onclick=()=>this.app.openAddingElement(),this.createBackupSubMenuItem.onclick=this.app.backup.getCreateBackupFunction(),this.loadBackupSubMenuItem.onclick=this.app.backup.getLoadBackupFunction(),this.changeLanguageSubMenuItem.onclick=()=>this.languageDialog.open(),this.navbar.addEventListener("dblclick",()=>{let e=this.app.localStorage.getNavBarPosition();e==="absolute"?e="fixed":e="absolute",this.navbar.style.position=e,this.search.searchList.style.position=e,this.app.localStorage.setNavBarPosition(e)})}clear(){this.search.clear()}toggleSubMenu(e){e.stopPropagation(),this.settingsSubMenu.classList.toggle("hide")}hideSubMenu(){p(this.settingsSubMenu)}handleDocumentClick(e){!this.settingsSubMenu.contains(e.target)&&!this.settingsSubMenuTitle.contains(e.target)&&this.hideSubMenu()}}class _{static CONTAINERS_KEY="containers";static NAVBAR_KEY="navbar";clear(){localStorage.clear()}createOrUpdateContainersParams(e){let t;try{t=JSON.parse(localStorage.getItem(_.CONTAINERS_KEY))}catch{}return t||(t={}),t[e]||(t[e]={}),t}getByKey(e){try{return JSON.parse(localStorage.getItem(e))}catch{return null}}setByKey(e,t){localStorage.setItem(e,JSON.stringify(t))}getCountNumberOfContainer(e){try{return this.getByKey(_.CONTAINERS_KEY)[e].count}catch{return null}}setCountNumberOfContainer(e,t){let i=this.createOrUpdateContainersParams(e);i[e].count=t,this.setByKey(_.CONTAINERS_KEY,i)}getGridStateOfContainer(e){try{return this.getByKey(_.CONTAINERS_KEY)[e].grid}catch{return null}}setGridStateOfContainer(e,t){let i=this.createOrUpdateContainersParams(e);i[e].grid=t,this.setByKey(_.CONTAINERS_KEY,i)}getNavBarPosition(){return localStorage.getItem(_.NAVBAR_KEY)}setNavBarPosition(e){localStorage.setItem(_.NAVBAR_KEY,e)}}class B{database;static#e;constructor(){this.database=h.getInstance(),this.containers=new Map,this.localStorage=new _,this.backup=new ue(this.database,()=>this.clearAll(),()=>this.initialize()),A.onItemClickListener=e=>this.openFullitem(e),this.menu=new de(this),this.addingFullItem=new U(e=>this.relocateSeries(e),this.database),this.main=document.createElement("main"),D("body").append(this.menu.getFragment(),this.main),this.onCreate()}static createApp(){B.#e||(B.#e=new B)}onCreate(){this.database.connect(()=>this.initialize()),this.setDayTimer(),document.addEventListener("languagechange",()=>{this.updateContainerTitles();for(const e of this.containers.values())for(const t of e.map.values())t.retranslate()})}initialize(){const e=new DocumentFragment;e.append(this.addingFullItem.getFragment());for(const t of Object.values(S)){const i=new ae(t,H().get(t),this);this.containers.set(t,i),e.append(i.getFragment())}this.main.append(e),this.database.foreach(t=>this.initialSplitSeries(t),t=>this.onInitialSplitSeriesEnd(t)),B.scrollToTop(),window.i18n.applyTo(document.body)}refresh(){this.menu.clear();for(let e of this.containers.values())e.clear();this.addingFullItem.close(),this.database.foreach(e=>this.initialSplitSeries(e),e=>this.onInitialSplitSeriesEnd(e)),B.scrollToTop()}static scrollToTop(){window.scrollTo({top:0,behavior:"smooth"})}clearAll(){this.clearRuntime(),this.localStorage.clear(),this.database.clear()}clearRuntime(){this.addingFullItem.remove();for(let e of this.containers.values())e.remove();this.containers.clear()}setDayTimer(){let e=new Date;e.setHours(0,0,1),e.setDate(e.getDate()+1),setTimeout(()=>{this.clearRuntime(),this.initialize(),this.setDayTimer()},e-new Date)}openAddingElement(){this.addingFullItem.open()}openFullitem(e){for(let t of this.containers.values())if(t.showFullItemIfExists(e))return}initialSplitSeries(e){e=A.create(e),this.containers.get(q(e)).simplyAddSeries(e)}onInitialSplitSeriesEnd(e){this.addingFullItem.setSeriesId(e+1);for(let t of this.containers.values())t.initialAdditionFinish()}relocateSeries(e,t=null){t||(t=q(e)),this.containers.get(t).addSeries(e)}onSearchItemClick(e){document.activeElement.blur(),this.openFullitem(e)}updateContainerTitles(){const e=H();for(const[t,i]of this.containers.entries())i.updateTitle(e.get(t))}}async function he(){try{const n=new URL("/SavingSeries/assets/templates-DKCOTXLm.html",import.meta.url).href,t=await(await fetch(n)).text(),i=document.createElement("div");i.innerHTML=t,i.querySelectorAll("template").forEach(a=>{document.body.appendChild(a)})}catch(n){console.error("Error injecting templates:",n)}}async function me(){await he(),B.createApp()}me().then(n=>{});
